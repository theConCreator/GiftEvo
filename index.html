<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* =======================================
           1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ –ê–¥–∞–ø—Ç–∞—Ü–∏—è TWA
           ======================================= */
        body {
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ TWA */
            background-color: var(--tg-theme-bg-color, #f4f4f5); /* –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω */
            color: var(--tg-theme-text-color, #1a1a1a); /* –¢–µ–º–Ω—ã–π —Ç–µ–∫—Å—Ç */
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh; /* –ó–∞–Ω–∏–º–∞–µ–º –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
            overflow: hidden; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
        }
        
        body.tg-dark {
            background-color: var(--tg-theme-bg-color, #1a1a2e);
            color: var(--tg-theme-text-color, #ffffff);
        }

        /* =======================================
           2. –•–µ–¥–µ—Ä (–î–≤–∞ —Ä—è–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
           ======================================= */
        .header {
            width: 100%;
            padding: 15px 20px 10px;
            box-sizing: border-box;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--tg-theme-secondary-bg-color, #ffffff); 
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .balance span, .current-prize span {
            font-weight: bold;
            color: var(--tg-theme-link-color, #007bff);
        }
        
        .header-title {
            font-size: 0.9em;
            color: var(--tg-theme-hint-color, #666);
        }

        /* =======================================
           3. –ò–≥—Ä–æ–≤–æ–π –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –°—Ç–æ–ø–∫–∞
           ======================================= */
        .game-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative; 
            overflow: hidden; /* –í–∞–∂–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–µ–∑–¥–∞ –∏–∑-–∑–∞ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã */
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã –∏ —Å—Ç–æ–ø–∫–∏ */
        #cardWrapper {
            width: 90%;
            max-width: 320px; /* –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç—ã */
            height: 250px; /* –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–µ–∑–¥–∞ */
            position: relative;
            bottom: 40px; /* –ü–æ–¥–Ω–∏–º–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫, —á—Ç–æ–±—ã —Å—Ç–æ–ø–∫–∞ –±—ã–ª–∞ –≤–∏–¥–Ω–∞ —Å–Ω–∏–∑—É */
        }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø–∫–∏ (–æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è) */
        .next-card-visual {
            width: 100%;
            height: 100%;
            background: #4a4a75; 
            border-radius: 15px;
            position: absolute;
            bottom: -50px; /* –°–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ */
            z-index: 5;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.5s ease-out;
            transform-origin: bottom; /* –¢–æ—á–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        }
        /* –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—Ç–æ–ø–∫–∞ —Å–ª–µ–≥–∫–∞ —Å–∂–∏–º–∞–µ—Ç—Å—è, –∏–º–∏—Ç–∏—Ä—É—è, —á—Ç–æ –∫–∞—Ä—Ç–∞ –≤—ã–µ–∑–∂–∞–µ—Ç */
        .next-card-visual.active {
            transform: scaleY(0.9);
        }

        /* =======================================
           4. –°—Ç–∏–ª–∏ –°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç—ã (1x3)
           ======================================= */
        #scratchCardContainer {
            width: 100%;
            height: 150px; /* –í—ã—Å–æ—Ç–∞ –¥–ª—è 1 —Ä—è–¥–∞ —è—á–µ–µ–∫ –∏ –æ—Ç—Å—Ç—É–ø–æ–≤ */
            position: absolute;
            bottom: 0;
            left: 0;
            z-index: 10; 
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–µ–∑–∂–∞—é—â–∏–µ —á–∞—Å—Ç–∏ */
        }

        .card-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-secondary-bg-color, #e0e0e0);
            border-radius: 15px;
            border: 2px dashed var(--tg-theme-hint-color, #999);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            position: absolute;
            bottom: 0;
            left: 0;
            z-index: 10;
        }

        .scratch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* –°–µ—Ç–∫–∞ 1x3 */
            grid-template-rows: 1fr;
            gap: 10px;
            padding: 15px;
            background-color: #5d5d9c; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –∫–∞—Ä—Ç—ã */
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            position: absolute;
            bottom: 0; /* –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –∫ –Ω–∏–∑—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            left: 0;
            z-index: 10;
            transition: transform 0.5s ease-out; /* –ê–Ω–∏–º–∞—Ü–∏—è "—Å–¥–≤–∏–≥–∞" */
        }

        .scratch-cell {
            height: 80px; /* –†–∞–∑–º–µ—Ä —è—á–µ–π–∫–∏ */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #8c52ff; /* –¶–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å */
            border-radius: 50%; /* –ö—Ä—É–≥–ª—ã–µ —è—á–µ–π–∫–∏ */
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
            user-select: none;
        }
        
        .scratched {
            background-color: #4a4a75; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–æ—Å–ª–µ —Å—Ç–∏—Ä–∞–Ω–∏—è */
        }

        .hidden-prize {
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .win-message {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 20;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        /* =======================================
           5. –§—É—Ç–µ—Ä –∏ –ö–Ω–æ–ø–∫–∞
           ======================================= */
        .footer {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 0;
            margin-top: auto;
        }

        .buy-button {
            background-color: var(--tg-theme-button-color, #007bff); 
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            width: 90%;
            max-width: 350px;
        }
    </style>
</head>
<body class="tg-light">

    <header class="header">
        <div class="header-row">
            <div class="header-title">–ë–∞–ª–∞–Ω—Å TON: <span id="tonBalance" class="balance-amount">10.50</span></div>
            <div class="header-title">–ü–æ—Å–ª–µ–¥–Ω–∏–π –í—ã–∏–≥—Ä—ã—à: <span id="currentPrize" class="prize-amount">0</span> TON</div>
        </div>
        <div class="header-row" style="font-weight: normal; color: var(--tg-theme-text-color, #1a1a1a);">
            <div class="balance">TON: <span class="balance-amount">10.50</span></div>
            <div class="current-prize">–ü–æ–¥–∞—Ä–∫–∏: <span class="prize-amount">0</span></div>
        </div>
    </header>

    <main class="game-container">
        <div id="cardWrapper">
            <div class="next-card-visual" id="nextCardVisual"></div>
            
            <div id="scratchCardContainer">
                <div class="card-placeholder">
                    –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <button id="buyCardButton" class="buy-button">
            üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (1 TON)
        </button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('scratchCardContainer');
            const cardWrapper = document.getElementById('cardWrapper');
            const nextCardVisual = document.getElementById('nextCardVisual');
            const buyButton = document.getElementById('buyCardButton');
            const currentPrizeDisplay = document.getElementById('currentPrize').querySelector('.prize-amount');
            const tonBalanceDisplay = document.getElementById('tonBalance');

            // --- TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.MainButton.hide(); 
                if (Telegram.WebApp.colorScheme === 'dark') {
                    document.body.classList.remove('tg-light');
                    document.body.classList.add('tg-dark');
                }
            }
            // --- –ö–æ–Ω–µ—Ü TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ---

            // –ù–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∏—Ö –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            const PRIZES = [
                { symbol: 'üòÇ', multiplier: 0.5 },
                { symbol: '‚≠ê', multiplier: 2.0 },
                { symbol: 'üíé', multiplier: 5.0 },
                { symbol: 'ü™ô', multiplier: 10.0 }
            ];
            const CARD_COST = 1.0;
            const CARD_SIZE = 3; // –°–µ—Ç–∫–∞ 1x3
            let scratchCount = 0;
            let currentPrizes = [];
            let testBalance = 10.50;
            
            // –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            function updateBalance(amount) {
                testBalance += amount;
                tonBalanceDisplay.textContent = testBalance.toFixed(2);
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ –Ω–∏–∂–Ω–µ–º —Ä—è–¥—É —Ö–µ–¥–µ—Ä–∞
                document.querySelector('.balance .balance-amount').textContent = testBalance.toFixed(2);
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã (–¢–µ—Å—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
            function generateRandomPrizes() {
                const prizes = [];
                for (let i = 0; i < CARD_SIZE; i++) {
                    const randomIndex = Math.floor(Math.random() * PRIZES.length);
                    prizes.push(PRIZES[randomIndex].symbol);
                }
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à (3 —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è) –¥–ª—è —Ç–µ—Å—Ç–∞
                if (Math.random() < 0.35) { 
                    const winningSymbol = PRIZES[Math.floor(Math.random() * 3) + 1].symbol; 
                    prizes[0] = winningSymbol;
                    prizes[1] = winningSymbol;
                    prizes[2] = winningSymbol;
                }

                return prizes;
            }

            /**
             * –°–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—É—é —Å–∫—Ä–µ—Ç—á-–∫–∞—Ä—Ç—É
             */
            function generateNewCard() {
                // –ê–Ω–∏–º–∞—Ü–∏—è: –°–¥–≤–∏–≥–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç—É –≤–Ω–∏–∑, –∏–º–∏—Ç–∏—Ä—É—è, —á—Ç–æ –æ–Ω–∞ —É—à–ª–∞
                const oldGrid = cardContainer.querySelector('.scratch-grid');
                if (oldGrid) {
                    oldGrid.style.transform = 'translateY(150%)'; 
                    setTimeout(() => oldGrid.remove(), 500); 
                }

                scratchCount = 0;
                currentPrizes = generateRandomPrizes();
                
                const cardGrid = document.createElement('div');
                cardGrid.classList.add('scratch-grid');
                cardGrid.style.transform = 'translateY(150%)'; // –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–Ω–∏–∑—É
                
                cardContainer.innerHTML = ''; 
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—Ç–æ–ø–∫–∏
                nextCardVisual.classList.add('active');

                currentPrizes.forEach((prize, index) => {
                    const cell = document.createElement('div');
                    cell.classList.add('scratch-cell');
                    
                    cell.innerHTML = `<span class="hidden-prize">${prize}</span>`;
                    cell.addEventListener('click', handleScratch);
                    cardGrid.appendChild(cell);
                });

                cardContainer.appendChild(cardGrid);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é: —Å–¥–≤–∏–≥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –Ω–∞ –º–µ—Å—Ç–æ (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
                setTimeout(() => {
                    cardGrid.style.transform = 'translateY(0)';
                    nextCardVisual.classList.remove('active');
                }, 10);
            }
            
            /**
             * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è —è—á–µ–π–∫–∏
             */
            function handleScratch(event) {
                const cell = event.currentTarget;
                
                if (cell.classList.contains('scratched')) return;

                cell.classList.add('scratched');
                cell.querySelector('.hidden-prize').style.opacity = '1';
                cell.removeEventListener('click', handleScratch);
                
                scratchCount++;
                
                if (scratchCount === CARD_SIZE) {
                    checkResult();
                    buyButton.disabled = false;
                    buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –°–ª–µ–¥—É—é—â—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
                }
            }

            /**
             * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
             */
            function checkResult() {
                const prizeCounts = {};
                currentPrizes.forEach(prize => {
                    prizeCounts[prize] = (prizeCounts[prize] || 0) + 1;
                });

                let winningMultiplier = 0;

                // –£—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞
                if (Object.values(prizeCounts).some(count => count === 3)) {
                     const winningSymbol = Object.keys(prizeCounts).find(key => prizeCounts[key] === 3);
                     const winPrize = PRIZES.find(p => p.symbol === winningSymbol);
                     winningMultiplier = winPrize ? winPrize.multiplier : 0;
                }
                
                const winAmount = winningMultiplier * CARD_COST;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ –Ω–∞–¥ –∫–∞—Ä—Ç–æ–π
                const msg = document.createElement('div');
                msg.classList.add('win-message');
                cardWrapper.prepend(msg); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–∞—Ä—Ç–æ–π

                if (winAmount > 0) {
                    msg.textContent = `üéâ –í–´–ò–ì–†–´–®: ${winAmount.toFixed(2)} TON! (x${winningMultiplier})`;
                    msg.style.color = '#00ff00';
                    updateBalance(winAmount);
                    currentPrizeDisplay.textContent = winAmount.toFixed(2);
                } else {
                    msg.textContent = `üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ.`;
                    msg.style.color = '#ff3333';
                    currentPrizeDisplay.textContent = '0';
                }

                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    msg.remove();
                }, 2500);
            }

            /**
             * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É (–µ—Å–ª–∏ –Ω–µ—Ç –∫–∞—Ä—Ç) –∏–ª–∏ –≥–æ—Ç–æ–≤–∏—Ç –∫ –ø–æ–∫—É–ø–∫–µ
             */
            function showNextCardPrompt() {
                cardContainer.innerHTML = `
                    <div class="card-placeholder">
                        –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!
                    </div>
                `;
                buyButton.disabled = false;
                buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å"
            buyButton.addEventListener('click', () => {
                if (!buyButton.disabled) {
                    if (testBalance < CARD_COST) {
                        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!");
                        return;
                    }
                    
                    updateBalance(-CARD_COST);
                    
                    buyButton.disabled = true;
                    buyButton.textContent = '–°—Ç–∏—Ä–∞–π—Ç–µ —è—á–µ–π–∫–∏...';
                    
                    generateNewCard();
                }
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            updateBalance(0);
            showNextCardPrompt(); 
        });
    </script>
</body>
</html>