<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* =======================================
           1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ –ê–¥–∞–ø—Ç–∞—Ü–∏—è TWA
           ======================================= */
        body {
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ TWA */
            background-color: var(--tg-theme-bg-color, #1a1a2e); 
            color: var(--tg-theme-text-color, #ffffff);
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –¥–∞—Ç—å "–ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏"
           –∏—Å–ø–æ–ª—å–∑—É—è 100% —à–∏—Ä–∏–Ω—É –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–∫—Ä–æ–ª–ª–æ–≤ */
        html, body {
            overflow-x: hidden;
        }

        .header {
            width: 90%;
            max-width: 400px;
            padding: 15px 0;
            text-align: center;
        }

        .balance, .current-prize {
            font-size: 1.1em;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--tg-theme-hint-color, #aaaaaa);
        }
        
        .balance span, .current-prize span {
             color: var(--tg-theme-link-color, #007bff);
        }

        .game-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ø–∫–∏ */
            height: 200px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ */
        }

        /* =======================================
           2. –°—Ç–∏–ª–∏ –°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç—ã –∏ –°—Ç–æ–ø–∫–∏
           ======================================= */
        #scratchCardContainer {
            width: 300px;
            height: 100px; /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É –¥–ª—è 1 —Ä—è–¥–∞ */
            position: relative;
        }

        .card-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-secondary-bg-color, #2b2b48);
            border-radius: 15px;
            border: 2px dashed var(--tg-theme-button-color, #4a4a75);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }
        
        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–µ–¥—É—é—â–µ–π –∫–∞—Ä—Ç—ã –≤ —Å—Ç–æ–ø–∫–µ */
        .next-card-visual {
            width: 95%; /* –ß—É—Ç—å –º–µ–Ω—å—à–µ */
            height: 100%;
            background: #3c3c63; /* –¶–≤–µ—Ç —á—É—Ç—å —Ç–µ–º–Ω–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–π */
            border-radius: 15px;
            position: absolute;
            top: 5px; /* –°–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ */
            left: 2.5%; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
            opacity: 0.6;
            z-index: 5; /* –ù–∏–∂–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .scratch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 —è—á–µ–π–∫–∏ */
            gap: 10px;
            padding: 10px;
            background-color: var(--tg-theme-secondary-bg-color, #3c3c63);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            transition: transform 0.5s ease-out; /* –ê–Ω–∏–º–∞—Ü–∏—è "—Å–¥–≤–∏–≥–∞" */
        }

        .scratch-cell {
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--tg-theme-button-color, #8c52ff); 
            border-radius: 8px;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
            user-select: none;
        }
        
        .scratched {
            background-color: var(--tg-theme-secondary-bg-color, #2b2b48); 
        }

        .hidden-prize {
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* =======================================
           3. –°—Ç–∏–ª–∏ –ö–Ω–æ–ø–∫–∏ –∏ –°–æ–æ–±—â–µ–Ω–∏—è
           ======================================= */
        .footer {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 0;
        }

        .buy-button {
            background-color: var(--tg-theme-button-color, #007bff); 
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            width: 90%;
            max-width: 350px;
        }

        .buy-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .win-message {
            text-align: center;
            font-size: 1.5em;
            color: #00ff00;
            margin-bottom: 15px;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="balance">
            –ë–∞–ª–∞–Ω—Å: <span id="tonBalance">10.50 TON</span>
        </div>
        <div class="current-prize">
            –ü–æ—Å–ª–µ–¥–Ω–∏–π –í—ã–∏–≥—Ä—ã—à: <span id="currentPrize">0 TON</span>
        </div>
    </header>

    <main class="game-container">
        <div class="next-card-visual" id="nextCardVisual"></div>
        
        <div id="scratchCardContainer">
            <div class="card-placeholder">
                –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É!
            </div>
        </div>
    </main>

    <footer class="footer">
        <button id="buyCardButton" class="buy-button">
            üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (1 TON)
        </button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('scratchCardContainer');
            const buyButton = document.getElementById('buyCardButton');
            const nextCardVisual = document.getElementById('nextCardVisual');
            const currentPrizeDisplay = document.getElementById('currentPrize');
            const tonBalanceDisplay = document.getElementById('tonBalance');

            // --- TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                // 1. –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
                Telegram.WebApp.MainButton.hide(); 
                // 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ (–¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è)
                document.body.style.backgroundColor = Telegram.WebApp.themeParams.bg_color || '#1a1a2e';
            }
            // --- –ö–æ–Ω–µ—Ü TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ---

            // –ù–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∏—Ö –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            const PRIZES = [
                { symbol: 'üòÇ', multiplier: 0.5 },
                { symbol: '‚≠ê', multiplier: 2.0 },
                { symbol: 'üíé', multiplier: 5.0 },
                { symbol: 'ü™ô', multiplier: 10.0 }
            ];
            const CARD_COST = 1.0;
            const CARD_SIZE = 3; // –ö–∞—Ä—Ç–∞ 1x3
            let scratchCount = 0;
            let currentPrizes = [];
            let testBalance = 10.50; // –¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
            
            // –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            function updateBalance(amount) {
                testBalance += amount;
                tonBalanceDisplay.textContent = testBalance.toFixed(2) + ' TON';
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã (–¢–µ—Å—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
            function generateRandomPrizes() {
                const prizes = [];
                for (let i = 0; i < CARD_SIZE; i++) {
                    const randomIndex = Math.floor(Math.random() * PRIZES.length);
                    prizes.push(PRIZES[randomIndex].symbol);
                }
                
                // –®–∞–Ω—Å 30% –Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à (–¥–ª—è —Ç–µ—Å—Ç–∞)
                if (Math.random() < 0.3) { 
                    const winningSymbol = PRIZES[Math.floor(Math.random() * 3) + 1].symbol; 
                    prizes[0] = winningSymbol;
                    prizes[1] = winningSymbol;
                    prizes[2] = winningSymbol;
                }

                return prizes;
            }

            /**
             * –°–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—É—é —Å–∫—Ä–µ—Ç—á-–∫–∞—Ä—Ç—É
             */
            function generateNewCard() {
                // –°–¥–≤–∏–≥–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç—É –≤ —Å—Ç–æ—Ä–æ–Ω—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ (–∏–º–∏—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è)
                const oldGrid = cardContainer.querySelector('.scratch-grid');
                if (oldGrid) {
                    oldGrid.style.transform = 'translateX(-150%)';
                    setTimeout(() => oldGrid.remove(), 500); // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                }

                scratchCount = 0;
                currentPrizes = generateRandomPrizes();
                
                const cardGrid = document.createElement('div');
                cardGrid.classList.add('scratch-grid');
                cardGrid.style.transform = 'translateX(150%)'; // –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–∞
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                cardContainer.innerHTML = ''; 

                currentPrizes.forEach((prize, index) => {
                    const cell = document.createElement('div');
                    cell.classList.add('scratch-cell');
                    cell.dataset.index = index;
                    
                    cell.innerHTML = `<span class="hidden-prize">${prize}</span>`;
                    cell.addEventListener('click', handleScratch);
                    cardGrid.appendChild(cell);
                });

                cardContainer.appendChild(cardGrid);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é: —Å–¥–≤–∏–≥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –Ω–∞ –º–µ—Å—Ç–æ
                setTimeout(() => {
                    cardGrid.style.transform = 'translateX(0)';
                }, 10);
            }
            
            /**
             * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è —è—á–µ–π–∫–∏
             */
            function handleScratch(event) {
                const cell = event.currentTarget;
                
                if (cell.classList.contains('scratched')) return;

                cell.classList.add('scratched');
                cell.querySelector('.hidden-prize').style.opacity = '1';
                cell.removeEventListener('click', handleScratch);
                
                scratchCount++;
                
                if (scratchCount === CARD_SIZE) {
                    checkResult();
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    buyButton.disabled = false;
                    buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –°–ª–µ–¥—É—é—â—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
                }
            }

            /**
             * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
             */
            function checkResult() {
                const prizeCounts = {};
                currentPrizes.forEach(prize => {
                    prizeCounts[prize] = (prizeCounts[prize] || 0) + 1;
                });

                let winningMultiplier = 0;

                // –£—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞
                if (Object.values(prizeCounts).some(count => count === 3)) {
                     const winningSymbol = Object.keys(prizeCounts).find(key => prizeCounts[key] === 3);
                     const winPrize = PRIZES.find(p => p.symbol === winningSymbol);
                     winningMultiplier = winPrize ? winPrize.multiplier : 0;
                }
                
                const winAmount = winningMultiplier * CARD_COST;
                
                if (winAmount > 0) {
                    const message = `üéâ –í–´–ò–ì–†–´–®: ${winAmount.toFixed(2)} TON! (x${winningMultiplier})`;
                    cardContainer.insertAdjacentHTML('beforebegin', `<div class="win-message">${message}</div>`);
                    updateBalance(winAmount);
                    currentPrizeDisplay.textContent = winAmount.toFixed(2) + ' TON';
                } else {
                    const message = `üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ.`;
                    cardContainer.insertAdjacentHTML('beforebegin', `<div class="win-message" style="color:#ff3333;">${message}</div>`);
                    currentPrizeDisplay.textContent = '0 TON';
                }

                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    const msg = document.querySelector('.win-message');
                    if (msg) msg.remove();
                }, 2500);
            }

            /**
             * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É (–µ—Å–ª–∏ –Ω–µ—Ç –∫–∞—Ä—Ç) –∏–ª–∏ –≥–æ—Ç–æ–≤–∏—Ç –∫ –ø–æ–∫—É–ø–∫–µ
             */
            function showNextCardPrompt() {
                cardContainer.innerHTML = `
                    <div class="card-placeholder">
                        –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞!
                    </div>
                `;
                buyButton.disabled = false;
                buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å"
            buyButton.addEventListener('click', () => {
                if (!buyButton.disabled) {
                    if (testBalance < CARD_COST) {
                        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!");
                        return;
                    }
                    
                    updateBalance(-CARD_COST); // –°–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
                    
                    buyButton.disabled = true;
                    buyButton.textContent = '–°—Ç–∏—Ä–∞–π—Ç–µ —è—á–µ–π–∫–∏...';
                    
                    generateNewCard();
                }
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            updateBalance(0); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å
            // nextCardVisual.style.opacity = '1'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–æ–ø–∫—É —Å—Ä–∞–∑—É
            showNextCardPrompt(); 
        });
    </script>
</body>
</html>