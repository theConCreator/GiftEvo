<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Orbit Pro: Classic Reboot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <style>
        :root { --primary: #00d4ff; --gold: #ffcc00; --bg: #010103; --glass: rgba(10, 20, 30, 0.9); }
        * { box-sizing: border-box; user-select: none; touch-action: none; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; }
        
        canvas { position: absolute; inset: 0; z-index: 1; }
        #rocket-layer { position: absolute; width: 80px; height: 80px; z-index: 10; pointer-events: none; }
        
        /* UI Elements */
        .panel { background: var(--glass); border: 1px solid rgba(0, 212, 255, 0.15); border-radius: 12px; backdrop-filter: blur(15px); pointer-events: auto; }
        
        .stat-card { position: absolute; top: 20px; left: 20px; padding: 12px 20px; color: var(--primary); font-weight: 900; z-index: 100; border-left: 4px solid var(--primary); }
        #bonus-display { position: absolute; top: 80px; left: 20px; color: var(--gold); font-weight: bold; z-index: 100; }

        #history-bar { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 100; }
        .h-chip { padding: 5px 12px; border-radius: 6px; background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.2); font-size: 12px; font-weight: 900; color: var(--primary); }

        .cam-btn { position: absolute; top: 20px; right: 20px; padding: 12px 20px; color: white; cursor: pointer; z-index: 100; font-weight: 900; }
        .cam-btn.active { background: var(--primary); color: #000; }

        #timer-display { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); text-align: center; z-index: 50; }
        .timer-val { font-size: 100px; font-weight: 900; color: var(--primary); line-height: 1; text-shadow: 0 0 30px var(--primary); }

        .bottom-ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 360px; z-index: 100; transition: 0.5s; }
        .bottom-ui.hidden { opacity: 0; transform: translate(-50%, 100px); }
        .bet-panel { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid #333; color: var(--primary); padding: 12px; border-radius: 10px; text-align: center; font-size: 20px; font-weight: 900; }
        .btn-launch { width: 100%; padding: 20px; background: var(--primary); color: #000; border: none; border-radius: 12px; font-size: 18px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .btn-launch:active { transform: scale(0.98); }

        /* Modal */
        #result-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(15px); }
        .modal-box { text-align: center; padding: 50px; border: 2px solid var(--primary); border-radius: 30px; background: #01050a; }
    </style>
</head>
<body>

<div id="rocket-layer"></div>
<canvas id="game"></canvas>

<div id="history-bar"></div>
<div class="panel stat-card">CREDITS: <span id="balance">1000</span></div>
<div id="bonus-display">BONUS: +x0.0</div>
<div class="panel cam-btn" id="camBtn">FOLLOW</div>

<div id="timer-display">
    <div id="countdown" class="timer-val">6.0</div>
</div>

<div class="bottom-ui" id="betContainer">
    <div class="panel bet-panel">
        <input type="number" id="betInput" value="100">
        <button class="btn-launch" id="launchBtn">INITIALIZE LAUNCH</button>
    </div>
</div>

<div id="result-modal">
    <div class="modal-box">
        <div id="res-status" style="opacity: 0.6; letter-spacing: 3px;">MISSION ENDED</div>
        <div id="res-mult" style="font-size: 80px; font-weight: 900; color: var(--primary); margin: 20px 0;">x0.0</div>
        <button class="btn-launch" onclick="resetGame()">NEXT MISSION</button>
    </div>
</div>

<script>
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
const rocketEl = document.getElementById('rocket-layer');

let state = 'BETTING', timer = 6.0, balance = 1000, currentBet = 0, bonusMult = 0;
let cam = { x: 0, y: 0, zoom: 0.015, tZoom: 0.015 };
let rocket = { x: 0, y: 0, vx: 0, vy: 0, angle: 0, targetAngle: 0, particles: [] };
let planets = [], stars = [], asteroids = [], comets = [], history = [1.5, 0.0, 4.2];
let camMode = 'follow';

function init() {
    resize();
    lottie.loadAnimation({ container: rocketEl, renderer: 'svg', loop: true, autoplay: true, path: 'rocket1.json' });
    createWorld();
    updateHistory();
    requestAnimationFrame(loop);
}

function updateHistory() {
    const bar = document.getElementById('history-bar');
    bar.innerHTML = history.map(h => `<div class="h-chip">x${h.toFixed(1)}</div>`).join('');
}

function createWorld() {
    stars = Array.from({length: 1000}, () => ({ x: Math.random()*200000-100000, y: Math.random()*200000-100000, s: Math.random()*2 }));
    planets = [];
    for(let i=0; i<7; i++) {
        const big = Math.random() > 0.4;
        planets.push({
            dist: 12000 + i*10000, angle: Math.random()*Math.PI*2, speed: 0.0001 + i*0.00005,
            r: big ? 1500 : 400, color: big ? '#0077ff' : '#00d4ff', mult: big ? 1.8 : 12.0, x: 0, y: 0
        });
    }
    asteroids = Array.from({length: 30}, () => ({ x: Math.random()*80000-40000, y: Math.random()*80000-40000, r: 150, active: true }));
    comets = Array.from({length: 3}, () => ({ x: -40000, y: Math.random()*40000-20000, vx: 100, vy: 20 }));
}

function update() {
    planets.forEach(p => { p.angle += p.speed; p.x = Math.cos(p.angle)*p.dist; p.y = Math.sin(p.angle)*p.dist; });

    if(state === 'BETTING') {
        timer -= 1/60;
        document.getElementById('countdown').innerText = Math.max(0, timer).toFixed(1);
        rocket.angle += 3;
        if(timer <= 0) { state = 'SPIN'; timer = 4.0; rocket.targetAngle = Math.random()*360; }
    } else if(state === 'SPIN') {
        timer -= 1/60;
        document.getElementById('countdown').innerText = Math.max(0, timer).toFixed(1);
        if(timer > 2) rocket.angle += 20;
        else rocket.angle += (rocket.targetAngle - (rocket.angle % 360)) * 0.1;
        if(timer <= 0) {
            state = 'FLY';
            rocket.vx = Math.cos(rocket.targetAngle*Math.PI/180)*55;
            rocket.vy = Math.sin(rocket.targetAngle*Math.PI/180)*55;
            document.getElementById('betContainer').classList.add('hidden');
            document.getElementById('timer-display').style.opacity = '0';
        }
    } else if(state === 'FLY') {
        // Ветер и Кометы
        rocket.vx += 0.02; // Солнечный ветер
        comets.forEach(c => {
            c.x += c.vx; c.y += c.vy;
            if(Math.hypot(c.x-rocket.x, c.y-rocket.y) < 800) rocket.vx += 2;
        });

        // Сбор бонусов
        asteroids.forEach(a => {
            if(a.active && Math.hypot(a.x-rocket.x, a.y-rocket.y) < 600) {
                a.active = false; bonusMult += 0.2;
                document.getElementById('bonus-display').innerText = `BONUS: +x${bonusMult.toFixed(1)}`;
            }
        });

        // Гравитация
        planets.forEach(p => {
            const d = Math.hypot(p.x-rocket.x, p.y-rocket.y);
            if(d < p.r*3) {
                rocket.vx += (p.x-rocket.x)/d * 3; rocket.vy += (p.y-rocket.y)/d * 3;
                if(d < p.r + 100) finish('SUCCESS', p.mult);
            }
        });

        rocket.x += rocket.vx; rocket.y += rocket.vy;
        rocket.angle = Math.atan2(rocket.vy, rocket.vx)*180/Math.PI;
        if(Math.hypot(rocket.x, rocket.y) > 90000) finish('LOST', 0);
    }

    // Камера
    if(camMode === 'follow') {
        cam.tX = rocket.x; cam.tY = rocket.y; cam.tZoom = 0.02 / (1 + Math.hypot(rocket.vx, rocket.vy)*0.01);
    } else {
        cam.tX = 0; cam.tY = 0; cam.tZoom = 0.005;
    }
    cam.x += (cam.tX - cam.x) * 0.1; cam.y += (cam.tY - cam.y) * 0.1;
    cam.zoom += (cam.tZoom - cam.zoom) * 0.05;

    // Позиция ракеты
    const sx = (rocket.x - cam.x)*cam.zoom + canvas.width/2;
    const sy = (rocket.y - cam.y)*cam.zoom + canvas.height/2;
    rocketEl.style.left = sx-40+'px'; rocketEl.style.top = sy-40+'px';
    rocketEl.style.transform = `scale(${cam.zoom * 30})`;
    rocketEl.style.rotate = (rocket.angle + 45) + 'deg';
}

function draw() {
    ctx.fillStyle = '#010103'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2); ctx.scale(cam.zoom, cam.zoom); ctx.translate(-cam.x, -cam.y);

    // Звезды
    ctx.fillStyle = "white";
    stars.forEach(s => ctx.beginPath() && ctx.arc(s.x, s.y, s.s/cam.zoom, 0, Math.PI*2) && ctx.fill());

    // Орбиты
    ctx.strokeStyle = "rgba(0, 212, 255, 0.1)"; ctx.setLineDash([15, 15]);
    planets.forEach(p => { ctx.beginPath(); ctx.arc(0,0,p.dist,0,Math.PI*2); ctx.stroke(); });
    ctx.setLineDash([]);

    // Золотые астероиды
    asteroids.forEach(a => {
        if(!a.active) return;
        ctx.fillStyle = "gold"; ctx.shadowBlur = 10; ctx.shadowColor = "gold";
        ctx.beginPath(); ctx.arc(a.x, a.y, a.r, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    });

    // Планеты
    planets.forEach(p => {
        ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "white"; ctx.font = "bold 400px Arial"; ctx.fillText("x"+p.mult, p.x-200, p.y-p.r-200);
    });

    ctx.restore();
}

function finish(type, m) {
    state = 'END';
    const final = type === 'LOST' ? 0 : parseFloat(m) + bonusMult;
    document.getElementById('res-mult').innerText = 'x' + final.toFixed(1);
    document.getElementById('result-modal').style.display = 'flex';
    history.unshift(final); if(history.length > 5) history.pop();
    updateHistory();
}

function resetGame() {
    location.reload(); // Для чистоты сброса всех состояний
}

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.onload = init;
window.onresize = resize;

document.getElementById('launchBtn').onclick = () => {
    if(state === 'BETTING') {
        currentBet = parseInt(document.getElementById('betInput').value);
        balance -= currentBet; document.getElementById('balance').innerText = balance;
        document.getElementById('launchBtn').innerText = "SYSTEMS READY";
        document.getElementById('launchBtn').style.background = "#1a3a4a";
    }
};

document.getElementById('camBtn').onclick = () => {
    camMode = camMode === 'follow' ? 'world' : 'follow';
    document.getElementById('camBtn').innerText = camMode.toUpperCase();
    document.getElementById('camBtn').classList.toggle('active');
};
</script>
</body>
</html>