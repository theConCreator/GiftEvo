<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Orbit Pro: Extreme Edition</title>
    <style>
        :root { --primary: #00d4ff; --gold: #ffcc00; --danger: #ff4d4d; --bg: #020205; }
        * { box-sizing: border-box; user-select: none; touch-action: none; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; }
        
        canvas { position: absolute; inset: 0; z-index: 1; }
        
        /* История */
        #history-bar { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 100; }
        .h-chip { padding: 4px 12px; border-radius: 20px; background: rgba(255,255,255,0.1); font-size: 12px; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); }
        .h-chip.win { color: var(--primary); border-color: var(--primary); }

        /* UI */
        .stat-card { position: absolute; top: 20px; left: 20px; padding: 12px 20px; background: rgba(0,0,0,0.5); border: 1px solid var(--primary); border-radius: 8px; backdrop-filter: blur(10px); z-index: 100; }
        #bonus-display { position: absolute; top: 80px; left: 20px; color: var(--gold); font-weight: bold; font-size: 18px; text-shadow: 0 0 10px var(--gold); }

        /* Экран финала */
        #result-modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; 
            display: none; align-items: center; justify-content: center; flex-direction: column;
            backdrop-filter: blur(15px); animation: fadeIn 0.3s;
        }
        .modal-content { text-align: center; transform: scale(0.8); animation: pop 0.5s forwards cubic-bezier(0.17, 0.89, 0.32, 1.49); }
        .res-mult { font-size: 80px; font-weight: 900; color: var(--primary); text-shadow: 0 0 40px var(--primary); margin: 10px 0; }
        .res-payout { font-size: 24px; color: var(--gold); margin-bottom: 30px; }
        .btn-again { padding: 15px 40px; background: var(--primary); color: black; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pop { to { transform: scale(1); } }

        /* Прежние стили кнопок */
        .bottom-ui { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); width: 340px; z-index: 100; }
        .bet-box { background: rgba(15,20,30,0.9); border: 1px solid rgba(0,212,255,0.3); padding: 20px; border-radius: 20px; text-align: center; }
        input { width: 100%; background: #000; border: 1px solid #1a3a4a; color: var(--primary); padding: 12px; border-radius: 10px; font-size: 20px; text-align: center; margin-bottom: 15px; }
        .btn-launch { width: 100%; padding: 18px; background: var(--primary); color: #000; border: none; border-radius: 12px; font-weight: 900; cursor: pointer; }
        
        #countdown { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 120px; font-weight: 900; color: var(--primary); pointer-events: none; text-shadow: 0 0 40px var(--primary); }
    </style>
</head>
<body>

<div id="history-bar"></div>

<div class="stat-card">BANK: <span id="balance">1000</span></div>
<div id="bonus-display">BONUS: +x0.0</div>

<div id="countdown">5.0</div>

<div class="bottom-ui" id="betContainer">
    <div class="bet-box">
        <input type="number" id="betInput" value="100" min="10">
        <button class="btn-launch" id="launchBtn">START MISSION</button>
    </div>
</div>

<div id="result-modal">
    <div class="modal-content">
        <div id="res-status" style="letter-spacing: 5px; opacity: 0.7;">MISSION COMPLETE</div>
        <div class="res-mult" id="res-mult">x2.5</div>
        <div class="res-payout" id="res-payout">WIN: 250.00</div>
        <button class="btn-again" onclick="location.reload()">NEXT LAUNCH</button>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
let state = 'BETTING', timer = 5.0, balance = 1000, currentBet = 0, bonusMult = 0;
let cam = { x: 0, y: 0, zoom: 0.015, shake: 0 };
let rocket = { x: 0, y: 0, vx: 0, vy: 0, angle: 0, particles: [] };
let planets = [], stars = [], asteroids = [], comets = [], history = [1.2, 5.4, 0.0, 2.1, 15.0];

function init() {
    resize();
    createWorld();
    updateHistory();
    requestAnimationFrame(loop);
}

function updateHistory() {
    const bar = document.getElementById('history-bar');
    bar.innerHTML = history.map(h => `<div class="h-chip ${h>0?'win':''}">x${h.toFixed(1)}</div>`).join('');
}

function createWorld() {
    stars = Array.from({length: 800}, () => ({ x: Math.random()*100000-50000, y: Math.random()*100000-50000, s: Math.random()*3 }));
    
    // Планеты
    for(let i=0; i<6; i++) {
        planets.push({
            x: Math.cos(i)* (15000 + i*8000), y: Math.sin(i)* (15000 + i*8000),
            r: 800 + Math.random()*1200, color: `hsl(${200 + i*20}, 80%, 50%)`, mult: (2 + i*4).toFixed(1)
        });
    }

    // Золотые астероиды (Feature 4)
    for(let i=0; i<40; i++) {
        asteroids.push({ x: Math.random()*80000-40000, y: Math.random()*80000-40000, r: 150, collected: false });
    }

    // Кометы (Feature 7)
    for(let i=0; i<5; i++) {
        comets.push({
            x: Math.random()*60000-30000, y: Math.random()*60000-30000,
            vx: (Math.random()-0.5)*150, vy: (Math.random()-0.5)*150
        });
    }
}

function update() {
    if(state === 'BETTING') {
        timer -= 1/60;
        document.getElementById('countdown').innerText = Math.max(0, timer).toFixed(1);
        if(timer <= 0) startFlight();
    } 
    
    if(state === 'FLY') {
        // Солнечный ветер (Feature 7) - легкий снос вправо-вверх
        rocket.vx += 0.05; rocket.vy -= 0.03;

        // Движение комет
        comets.forEach(c => {
            c.x += c.vx; c.y += c.vy;
            if(Math.hypot(c.x - rocket.x, c.y - rocket.y) < 600) {
                rocket.vx += c.vx * 0.2; rocket.vy += c.vy * 0.2; // Сбивают курс
                cam.shake = 10;
            }
        });

        // Сбор астероидов (Feature 4)
        asteroids.forEach(a => {
            if(!a.collected && Math.hypot(a.x - rocket.x, a.y - rocket.y) < 500) {
                a.collected = true;
                bonusMult += 0.2;
                cam.shake = 5;
                document.getElementById('bonus-display').innerText = `BONUS: +x${bonusMult.toFixed(1)}`;
            }
        });

        // Гравитация планет
        planets.forEach(p => {
            const d = Math.hypot(p.x - rocket.x, p.y - rocket.y);
            if(d < p.r * 3) {
                rocket.vx += (p.x - rocket.x) / d * 2;
                rocket.vy += (p.y - rocket.y) / d * 2;
                if(d < p.r + 100) finish('LANDED', p.mult);
            }
        });

        rocket.x += rocket.vx; rocket.y += rocket.vy;
        rocket.angle = Math.atan2(rocket.vy, rocket.vx);
        if(Math.random() > 0.4) rocket.particles.push({x: rocket.x, y: rocket.y, l: 1});
        if(Math.hypot(rocket.x, rocket.y) > 80000) finish('LOST', 0);
    }

    // Плавная камера
    cam.x += (rocket.x - cam.x) * 0.1;
    cam.y += (rocket.y - cam.y) * 0.1;
    if(cam.shake > 0) cam.shake *= 0.9;
}

function draw() {
    ctx.fillStyle = '#020205'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.translate(canvas.width/2 + (Math.random()-0.5)*cam.shake, canvas.height/2 + (Math.random()-0.5)*cam.shake);
    ctx.scale(cam.zoom, cam.zoom);
    ctx.translate(-cam.x, -cam.y);

    // Звезды
    ctx.fillStyle = "white";
    stars.forEach(s => ctx.fillRect(s.x, s.y, s.s/cam.zoom, s.s/cam.zoom));

    // Солнечный ветер (Визуал)
    ctx.strokeStyle = "rgba(0, 212, 255, 0.05)";
    for(let i=0; i<10; i++) {
        ctx.beginPath(); ctx.moveTo(-50000, i*10000 - 50000); ctx.lineTo(50000, i*10000 - 40000); ctx.stroke();
    }

    // Астероиды
    asteroids.forEach(a => {
        if(a.collected) return;
        ctx.shadowBlur = 15; ctx.shadowColor = "gold";
        ctx.fillStyle = "gold"; ctx.beginPath(); ctx.arc(a.x, a.y, a.r, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    });

    // Кометы
    comets.forEach(c => {
        ctx.fillStyle = "rgba(255, 100, 100, 0.5)";
        ctx.beginPath(); ctx.arc(c.x, c.y, 400, 0, Math.PI*2); ctx.fill();
    });

    // Планеты
    planets.forEach(p => {
        ctx.shadowBlur = 30; ctx.shadowColor = p.color;
        ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
        ctx.fillStyle = "white"; ctx.font = "bold 600px Arial"; ctx.fillText("x"+p.mult, p.x - 300, p.y - p.r - 200);
    });

    // Ракета
    ctx.save();
    ctx.translate(rocket.x, rocket.y);
    ctx.rotate(rocket.angle + Math.PI/2);
    ctx.fillStyle = "white";
    ctx.beginPath(); ctx.moveTo(0, -600); ctx.lineTo(300, 400); ctx.lineTo(-300, 400); ctx.fill();
    // Огонь
    ctx.fillStyle = "orange"; ctx.fillRect(-150, 400, 300, 200);
    ctx.restore();

    ctx.restore();
}

function startFlight() {
    state = 'FLY';
    currentBet = parseInt(document.getElementById('betInput').value);
    balance -= currentBet;
    document.getElementById('balance').innerText = balance;
    document.getElementById('betContainer').style.display = 'none';
    document.getElementById('countdown').style.display = 'none';
    const ang = Math.random() * Math.PI * 2;
    rocket.vx = Math.cos(ang) * 60; rocket.vy = Math.sin(ang) * 60;
}

function finish(type, mult) {
    state = 'END';
    const finalMult = type === 'LOST' ? 0 : parseFloat(mult) + bonusMult;
    const win = currentBet * finalMult;
    balance += win;

    history.unshift(finalMult);
    if(history.length > 8) history.pop();

    document.getElementById('res-status').innerText = type === 'LOST' ? 'MISSION FAILED' : 'SUCCESSFUL LANDING';
    document.getElementById('res-mult').innerText = `x${finalMult.toFixed(1)}`;
    document.getElementById('res-payout').innerText = `WIN: ${win.toFixed(2)}`;
    document.getElementById('result-modal').style.display = 'flex';
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }

document.getElementById('launchBtn').onclick = () => { timer = 0.1; };
window.onload = init;
window.onresize = resize;
</script>
</body>
</html>