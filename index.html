<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Прыгающая Кирка - Minecraft Arcade</title>
    <style>
        /* CSS Стили для фиксированного макета */
        body {
            background-color: #282c34;
            color: #fff;
            font-family: 'Courier New', monospace;
            /* Фиксируем макет по центру, убираем прокрутку */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh; /* Высота равна высоте окна просмотра */
            margin: 0;
            overflow: hidden; /* Убираем прокрутку */
        }

        h1, p {
            margin: 5px 0;
        }

        #game-container {
            display: flex;
            flex-direction: row;
            border: 5px solid #000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            background-color: #444; 
            margin-top: 10px; /* Отступ от заголовка */
        }

        #info-panel {
            width: 150px; 
            background-color: #333;
            padding: 10px;
            text-align: left;
            border-right: 2px solid #000;
            font-size: 0.9em;
        }

        #info-panel h3 {
            margin-top: 0;
            text-align: center;
        }

        .resource-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .resource-color {
            width: 14px;
            height: 14px;
            margin-right: 8px;
            border: 1px solid #111;
        }

        #game-canvas {
            display: block; 
            background-color: #6d6d6d;
        }
        
        button {
            margin-top: 20px; 
            padding: 10px 20px; 
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <h1>⛏️ Прыгающая Кирка</h1>
    <p>Цель: набрать как можно больше алмазов, пока кирка не упадет!</p>

    <div id="game-container">
        <div id="info-panel">
            <h3>Ресурсы:</h3>
            <div class="resource-item"><div class="resource-color" style="background-color: #555555;"></div>Уголь: <span id="coal-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #c7c7c7;"></div>Железо: <span id="iron-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #ffcc00;"></div>Золото: <span id="gold-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #66ffff;"></div>Алмазы: <span id="diamond-count">0</span></div>
        </div>
        
        <canvas id="game-canvas"></canvas>
    </div>
    
    <button onclick="startGame()">Запустить Кирку!</button>

    <script>
        // JavaScript Логика Игры
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const button = document.querySelector('button');

        // --- Константы ---
        const BLOCK_SIZE = 32; 
        const GAME_WIDTH = 15;
        const GAME_HEIGHT = 20;
        const INITIAL_SPEED = 6; // Начальная скорость падения (пикселей в кадр)
        const BOUNCE_FACTOR = 1.0; // Коэффициент отскока (1.0 = не теряет скорость)
        const HORIZONTAL_MOMENTUM = 3; // Горизонтальный импульс при отскоке

        canvas.width = GAME_WIDTH * BLOCK_SIZE;
        canvas.height = GAME_HEIGHT * BLOCK_SIZE;

        // --- Типы Блоков ---
        const BLOCK_TYPES = {
            AIR: 0,
            STONE: 1,
            COAL: 2,
            IRON: 3,
            GOLD: 4,
            DIAMOND: 5,
        };

        const BLOCK_COLORS = {
            [BLOCK_TYPES.STONE]: '#a0a0a0',
            [BLOCK_TYPES.COAL]: '#555555',
            [BLOCK_TYPES.IRON]: '#c7c7c7',
            [BLOCK_TYPES.GOLD]: '#ffcc00',
            [BLOCK_TYPES.DIAMOND]: '#66ffff'
        };

        // --- Состояние Игры ---
        let gameGrid = [];
        let pickaxe = {
            // Позиция в пикселях
            x: GAME_WIDTH / 2 * BLOCK_SIZE, 
            y: 0, 
            vy: INITIAL_SPEED, 
            vx: 0,
            radius: BLOCK_SIZE / 2 // Используем радиус для проверки столкновений
        };
        let resources = {
            [BLOCK_TYPES.COAL]: 0,
            [BLOCK_TYPES.IRON]: 0,
            [BLOCK_TYPES.GOLD]: 0,
            [BLOCK_TYPES.DIAMOND]: 0
        };
        let gameInterval = null;

        // --- Функции Инициализации ---

        function generateInitialGrid() {
            gameGrid = [];
            for (let y = 0; y < GAME_HEIGHT; y++) {
                gameGrid[y] = [];
                for (let x = 0; x < GAME_WIDTH; x++) {
                    gameGrid[y][x] = BLOCK_TYPES.STONE; 
                    
                    if (y > 3) {
                        const rand = Math.random();
                        if (y > 16 && rand < 0.02) gameGrid[y][x] = BLOCK_TYPES.DIAMOND;
                        else if (y > 12 && rand < 0.06) gameGrid[y][x] = BLOCK_TYPES.GOLD;
                        else if (y > 8 && rand < 0.12) gameGrid[y][x] = BLOCK_TYPES.IRON;
                        else if (rand < 0.25) gameGrid[y][x] = BLOCK_TYPES.COAL;
                    }
                    if (y < 3) gameGrid[y][x] = BLOCK_TYPES.AIR;
                }
            }
        }

        function resetPickaxe() {
            pickaxe.x = GAME_WIDTH / 2 * BLOCK_SIZE;
            pickaxe.y = pickaxe.radius; // Стартуем в верхней части первого блока
            pickaxe.vy = INITIAL_SPEED;
            pickaxe.vx = 0;
        }

        function startGame() {
            if (gameInterval) clearInterval(gameInterval);
            
            generateInitialGrid(); // Генерируем поле заново
            resetPickaxe();
            Object.keys(resources).forEach(key => resources[key] = 0);
            updateResourcesDisplay();
            button.disabled = true;
            button.innerText = "Кирка в работе...";
            
            gameInterval = setInterval(gameLoop, 1000 / 60); // 60 кадров в секунду
        }

        // --- Отрисовка ---

        function drawBlock(x, y, type) {
            if (type === BLOCK_TYPES.AIR) return;

            ctx.fillStyle = BLOCK_COLORS[type] || '#555';
            ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            
            ctx.strokeStyle = '#00000033'; 
            ctx.lineWidth = 1;
            ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            
            if (type !== BLOCK_TYPES.STONE) {
                // Имитация пиксельной текстуры (руды)
                ctx.fillStyle = 'black';
                for (let i = 0; i < 4; i++) {
                    const px = x * BLOCK_SIZE + Math.floor(Math.random() * BLOCK_SIZE);
                    const py = y * BLOCK_SIZE + Math.floor(Math.random() * BLOCK_SIZE);
                    ctx.fillRect(px, py, 2, 2);
                }
            }
        }

        function drawPickaxe() {
            // Рисуем кирку (Алмазный стиль, повернутый для падения)
            const S = BLOCK_SIZE / 16; 
            
            // Координаты центра кирки
            const centerX = pickaxe.x;
            const centerY = pickaxe.y;

            // Смещения для центрирования спрайта (спрайт 16x16)
            const x = centerX - 8 * S;
            const y = centerY - 8 * S;

            const pixelArt = [
                // Рукоятка (Коричневый)
                {c: '#964b00', x: 1, y: 0, w: 4, h: 2}, 
                {c: '#964b00', x: 2, y: 2, w: 2, h: 10}, 

                // Лезвие (Алмазный цвет)
                {c: '#66ffff', x: 0, y: 10, w: 12, h: 2}, 
                {c: '#66ffff', x: 12, y: 10, w: 1, h: 2}, 
                {c: '#66ffff', x: 1, y: 8, w: 1, h: 2},  
                {c: '#66ffff', x: 10, y: 12, w: 2, h: 2}, 
            ];

            pixelArt.forEach(p => {
                ctx.fillStyle = p.c;
                ctx.fillRect(x + p.x * S, y + p.y * S, p.w * S, p.h * S);
            });
            
            // Контур
            ctx.strokeStyle = '#00000088'; 
            ctx.lineWidth = 1;
            ctx.strokeRect(x + 2 * S, y + 2 * S, 2 * S, 10 * S);
            ctx.strokeRect(x, y + 10 * S, 12 * S, 2 * S);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Отрисовка сетки блоков
            for (let y = 0; y < GAME_HEIGHT; y++) {
                for (let x = 0; x < GAME_WIDTH; x++) {
                    drawBlock(x, y, gameGrid[y][x]);
                }
            }

            // Отрисовка кирки
            drawPickaxe();
        }

        // --- Игровая Логика ---

        function updateResourcesDisplay() {
            document.getElementById('coal-count').innerText = resources[BLOCK_TYPES.COAL];
            document.getElementById('iron-count').innerText = resources[BLOCK_TYPES.IRON];
            document.getElementById('gold-count').innerText = resources[BLOCK_TYPES.GOLD];
            document.getElementById('diamond-count').innerText = resources[BLOCK_TYPES.DIAMOND];
        }

        function update() {
            // 1. Обновление позиции (пиксели)
            pickaxe.y += pickaxe.vy; 
            pickaxe.x += pickaxe.vx;
            
            // 2. Проверка границ по горизонтали
            if (pickaxe.x <= pickaxe.radius || pickaxe.x >= canvas.width - pickaxe.radius) {
                pickaxe.vx *= -1;
                // Скорректируем позицию
                pickaxe.x = Math.max(pickaxe.radius, Math.min(canvas.width - pickaxe.radius, pickaxe.x));
            }

            // 3. Проверка границ по вертикали
            if (pickaxe.y <= pickaxe.radius) {
                pickaxe.vy *= -1; // Отскок от потолка
                pickaxe.y = pickaxe.radius;
            }
            if (pickaxe.y >= canvas.height + pickaxe.radius) {
                 // Кирка пролетела мимо дна
                clearInterval(gameInterval);
                gameInterval = null;
                button.disabled = false;
                button.innerText = "Игра окончена! Запустить снова.";
                alert("Кирка упала на дно мира! Ваши алмазы: " + resources[BLOCK_TYPES.DIAMOND]);
                return;
            }

            // 4. Проверка столкновений с блоками
            
            // Определяем ячейку, в которой находится центр кирки
            const gridX = Math.floor(pickaxe.x / BLOCK_SIZE);
            const gridY = Math.floor(pickaxe.y / BLOCK_SIZE);

            if (gridY >= 0 && gridY < GAME_HEIGHT && gridX >= 0 && gridX < GAME_WIDTH) {
                const blockType = gameGrid[gridY][gridX];

                if (blockType !== BLOCK_TYPES.AIR) {
                    // Столкновение!
                    
                    // a) Добыча ресурса
                    if (resources[blockType] !== undefined) {
                        resources[blockType]++;
                        updateResourcesDisplay();
                    }

                    // b) Удаление блока
                    gameGrid[gridY][gridX] = BLOCK_TYPES.AIR;
                    
                    // c) Отскок (инвертируем вертикальную скорость)
                    // Мы не знаем, с какой стороны кирка попала, поэтому просто инвертируем VY для отскока
                    pickaxe.vy *= -BOUNCE_FACTOR; 
                    
                    // d) Случайный горизонтальный сдвиг для динамики
                    const jumpDirection = Math.random() < 0.5 ? -1 : 1;
                    pickaxe.vx += jumpDirection * HORIZONTAL_MOMENTUM * Math.random(); 
                    pickaxe.vx = Math.max(-10, Math.min(10, pickaxe.vx)); 
                }
            }
        }

        function gameLoop() {
            update();
            draw();
        }

        // Инициализация при загрузке страницы
        generateInitialGrid();
        draw(); 
    </script>

</body>
</html>