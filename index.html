<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* =======================================
           1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ TWA (–¢–µ–º–Ω–∞—è —Ç–µ–º–∞)
           ======================================= */
        :root {
            /* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö —Ü–≤–µ—Ç–æ–≤ */
            --game-bg-color: #1a1a2e;
            --game-secondary-color: #2b2b48;
            --game-card-main: #4d3a86; /* –ù–∞—Å—ã—â–µ–Ω–Ω—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
            --game-card-scratch: #9c6cff; /* –Ø—Ä–∫–∏–π —Ü–≤–µ—Ç –¥–ª—è —Å—Ç–∏—Ä–∞–Ω–∏—è */
            --game-accent: #00ffc4; /* –Ø—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–∞ */
            --game-button-color: #007bff;
        }

        body {
            background-color: var(--game-bg-color); 
            color: #ffffff;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        
        /* =======================================
           2. –•–µ–¥–µ—Ä (–¢–µ–º–Ω—ã–π)
           ======================================= */
        .header {
            width: 100%;
            padding: 15px 20px 10px;
            box-sizing: border-box;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background-color: var(--game-secondary-color);
            flex-shrink: 0;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .balance span, .current-prize span {
            font-weight: bold;
            color: var(--game-accent); 
        }
        
        .header-title {
            font-size: 0.9em;
            color: #b0b0b0;
        }

        /* =======================================
           3. –ò–≥—Ä–æ–≤–æ–π –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ)
           ======================================= */
        .game-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            width: 100%;
            position: relative; 
        }
        
        #cardWrapper {
            width: 90%;
            max-width: 380px;
            height: 140px; 
            position: relative;
            margin: auto;
            /* –ß—Ç–æ–±—ã —Å—Ç–æ–ø–∫–∞ –≤—ã–≥–ª—è–¥–µ–ª–∞ —Ç–æ–ª—â–µ, –¥–æ–±–∞–≤–∏–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–Ω–∏–∑—É */
            padding-bottom: 30px; 
        }

        /* =======================================
           4. –°—Ç–æ–ø–∫–∞ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏)
           ======================================= */
        .next-card-visual {
            width: 100%;
            height: 100%;
            background: #201a35; 
            border-radius: 12px;
            position: absolute;
            z-index: 5;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease-out, opacity 0.2s;
            transform-origin: bottom;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç–æ–ø–∫–∏ */
        .next-card-visual:nth-child(1) { top: 20px; left: 1px; opacity: 0.7; }
        .next-card-visual:nth-child(2) { top: 15px; left: 0.5px; opacity: 0.8; }
        .next-card-visual:nth-child(3) { top: 10px; left: 0; opacity: 0.85; }
        .next-card-visual:nth-child(4) { top: 5px; left: -0.5px; opacity: 0.9; }
        .next-card-visual:nth-child(5) { top: 0px; left: -1px; opacity: 0.95; }
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—É–¥—É—Ç –Ω–µ–≤–∏–¥–∏–º—ã –∑–∞ —ç—Ç–∏–º–∏, —Å–æ–∑–¥–∞–≤–∞—è —Ç–æ–ª—â–∏–Ω—É */
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã */
        .next-card-visual:nth-child(n+6) { display: none; }


        .next-card-visual.active { transform: scaleY(0.9); }

        /* =======================================
           5. –ê–∫—Ç–∏–≤–Ω–∞—è –ö–∞—Ä—Ç–∞ (–î–∏–∑–∞–π–Ω)
           ======================================= */
        #scratchCardContainer {
            width: 100%;
            height: 100%; 
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10; 
        }

        .card-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: var(--game-secondary-color);
            border-radius: 12px;
            border: 2px dashed #7a5dbe;
            text-align: center;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .scratch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px;
            padding: 15px;
            background: linear-gradient(135deg, var(--game-card-main), #6b4aa8); 
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7); 
            border: 2px solid #b0b0b0; 
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            transition: transform 0.5s ease-out;
        }

        .scratch-cell {
            height: 100%; 
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--game-card-scratch); 
            border-radius: 50%;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
            user-select: none;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .scratched {
            background-color: #3b3b5e; 
        }

        .hidden-prize {
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .win-message {
            position: absolute;
            top: -50px; 
            width: 100%;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            z-index: 20;
            color: var(--game-accent);
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        /* =======================================
           6. –§—É—Ç–µ—Ä –∏ –ö–Ω–æ–ø–∫–∞
           ======================================= */
        .footer {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 0;
            flex-shrink: 0;
        }

        .buy-button {
            background-color: var(--game-button-color); 
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            width: 90%;
            max-width: 350px;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
        .buy-button:disabled {
            background-color: #555;
            color: #ccc;
            cursor: not-allowed;
            opacity: 0.8;
        }
    </style>
</head>
<body class="tg-dark">

    <header class="header">
        <div class="header-row">
            <div class="header-title">–ë–∞–ª–∞–Ω—Å TON: <span id="tonBalance" class="balance-amount">10.50</span></div>
            <div class="header-title">–ü–æ—Å–ª–µ–¥–Ω–∏–π –í—ã–∏–≥—Ä—ã—à: <span id="currentPrize" class="prize-amount">0</span> TON</div>
        </div>
        <div class="header-row" style="font-weight: normal; color: #b0b0b0;">
            <div class="balance">TON: <span class="balance-amount">10.50</span></div>
            <div class="current-prize">–ü–æ–¥–∞—Ä–∫–∏: <span class="prize-amount">0</span></div>
        </div>
    </header>

    <main class="game-container">
        <div id="cardWrapper">
            <div class="next-card-visual" data-stack-index="1"></div>
            <div class="next-card-visual" data-stack-index="2"></div>
            <div class="next-card-visual" data-stack-index="3"></div>
            <div class="next-card-visual" data-stack-index="4"></div>
            <div class="next-card-visual" data-stack-index="5"></div>
            <div class="next-card-visual" data-stack-index="6"></div>
            <div class="next-card-visual" data-stack-index="7"></div>
            <div class="next-card-visual" data-stack-index="8"></div>
            <div class="next-card-visual" data-stack-index="9"></div>
            <div class="next-card-visual" data-stack-index="10"></div>
            
            <div id="scratchCardContainer">
                <div class="card-placeholder">
                    –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <button id="buyCardButton" class="buy-button">
            üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (1 TON)
        </button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('scratchCardContainer');
            const cardWrapper = document.getElementById('cardWrapper');
            const nextCardVisuals = document.querySelectorAll('.next-card-visual');
            const buyButton = document.getElementById('buyCardButton');
            const currentPrizeDisplay = document.getElementById('currentPrize').querySelector('.prize-amount');
            const tonBalanceDisplay = document.getElementById('tonBalance');

            // --- TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.MainButton.hide(); 
                document.body.classList.add('tg-dark');
            }
            // --- –ö–æ–Ω–µ—Ü TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ---

            // –ù–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∏—Ö –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            const PRIZES = [
                { symbol: 'üòÇ', multiplier: 0.5 },
                { symbol: '‚≠ê', multiplier: 2.0 },
                { symbol: 'üíé', multiplier: 5.0 },
                { symbol: 'ü™ô', multiplier: 10.0 }
            ];
            const CARD_COST = 1.0;
            const CARD_SIZE = 3; // –°–µ—Ç–∫–∞ 1x3
            let scratchCount = 0;
            let currentPrizes = [];
            let testBalance = 10.50;
            
            // –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            function updateBalance(amount) {
                testBalance += amount;
                tonBalanceDisplay.textContent = testBalance.toFixed(2);
                document.querySelector('.balance .balance-amount').textContent = testBalance.toFixed(2);
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã (–¢–µ—Å—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
            function generateRandomPrizes() {
                const prizes = [];
                for (let i = 0; i < CARD_SIZE; i++) {
                    const randomIndex = Math.floor(Math.random() * PRIZES.length);
                    prizes.push(PRIZES[randomIndex].symbol);
                }
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à (3 —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è) –¥–ª—è —Ç–µ—Å—Ç–∞
                if (Math.random() < 0.35) { 
                    const winningSymbol = PRIZES[Math.floor(Math.random() * 3) + 1].symbol; 
                    prizes[0] = winningSymbol;
                    prizes[1] = winningSymbol;
                    prizes[2] = winningSymbol;
                }

                return prizes;
            }

            /**
             * –°–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—É—é —Å–∫—Ä–µ—Ç—á-–∫–∞—Ä—Ç—É
             */
            function generateNewCard() {
                // –ê–Ω–∏–º–∞—Ü–∏—è: –°–¥–≤–∏–≥–∞–µ–º —Å—Ç–∞—Ä—É—é –∫–∞—Ä—Ç—É –≤–Ω–∏–∑, –∏–º–∏—Ç–∏—Ä—É—è, —á—Ç–æ –æ–Ω–∞ —É—à–ª–∞
                const oldGrid = cardContainer.querySelector('.scratch-grid');
                if (oldGrid) {
                    oldGrid.style.transform = 'translateY(150%)'; 
                    setTimeout(() => oldGrid.remove(), 500); 
                }

                scratchCount = 0;
                currentPrizes = generateRandomPrizes();
                
                const cardGrid = document.createElement('div');
                cardGrid.classList.add('scratch-grid');
                cardGrid.style.transform = 'translateY(150%)'; // –ù–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–Ω–∏–∑—É
                
                cardContainer.innerHTML = ''; 
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—Ç–æ–ø–∫–∏ (—ç—Ñ—Ñ–µ–∫—Ç —Å–∂–∞—Ç–∏—è)
                nextCardVisuals.forEach(el => el.classList.add('active'));


                currentPrizes.forEach((prize, index) => {
                    const cell = document.createElement('div');
                    cell.classList.add('scratch-cell');
                    
                    cell.innerHTML = `<span class="hidden-prize">${prize}</span>`;
                    cell.addEventListener('click', handleScratch);
                    cardGrid.appendChild(cell);
                });

                cardContainer.appendChild(cardGrid);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é: —Å–¥–≤–∏–≥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –Ω–∞ –º–µ—Å—Ç–æ (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
                setTimeout(() => {
                    cardGrid.style.transform = 'translateY(0)';
                    // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—Ç–æ–ø–∫–∏
                    nextCardVisuals.forEach(el => el.classList.remove('active'));
                }, 10);
            }
            
            /**
             * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è —è—á–µ–π–∫–∏
             */
            function handleScratch(event) {
                const cell = event.currentTarget;
                
                if (cell.classList.contains('scratched')) return;

                cell.classList.add('scratched');
                cell.querySelector('.hidden-prize').style.opacity = '1';
                cell.removeEventListener('click', handleScratch);
                
                scratchCount++;
                
                if (scratchCount === CARD_SIZE) {
                    checkResult();
                    // *** –ò–°–ü–†–ê–í–õ–ï–ù–û: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ ***
                    buyButton.disabled = false;
                    buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –°–ª–µ–¥—É—é—â—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
                }
            }

            /**
             * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
             */
            function checkResult() {
                const prizeCounts = {};
                currentPrizes.forEach(prize => {
                    prizeCounts[prize] = (prizeCounts[prize] || 0) + 1;
                });

                let winningMultiplier = 0;

                // –£—Å–ª–æ–≤–∏–µ –ø–æ–±–µ–¥—ã: 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞
                if (Object.values(prizeCounts).some(count => count === 3)) {
                     const winningSymbol = Object.keys(prizeCounts).find(key => prizeCounts[key] === 3);
                     const winPrize = PRIZES.find(p => p.symbol === winningSymbol);
                     winningMultiplier = winPrize ? winPrize.multiplier : 0;
                }
                
                const winAmount = winningMultiplier * CARD_COST;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ –Ω–∞–¥ –∫–∞—Ä—Ç–æ–π
                const msg = document.createElement('div');
                msg.classList.add('win-message');
                cardWrapper.prepend(msg); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∫–∞—Ä—Ç–æ–π

                if (winAmount > 0) {
                    msg.textContent = `üéâ –í–´–ò–ì–†–´–®: ${winAmount.toFixed(2)} TON! (x${winningMultiplier})`;
                    updateBalance(winAmount);
                    currentPrizeDisplay.textContent = winAmount.toFixed(2);
                } else {
                    msg.textContent = `üòî –ù–ï –ü–û–í–ï–ó–õ–û.`;
                    msg.style.color = '#ff6666';
                    currentPrizeDisplay.textContent = '0';
                }

                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    msg.remove();
                }, 2500);
            }

            /**
             * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É (–µ—Å–ª–∏ –Ω–µ—Ç –∫–∞—Ä—Ç) –∏–ª–∏ –≥–æ—Ç–æ–≤–∏—Ç –∫ –ø–æ–∫—É–ø–∫–µ
             */
            function showNextCardPrompt() {
                cardContainer.innerHTML = `
                    <div class="card-placeholder">
                        –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!
                    </div>
                `;
                buyButton.disabled = false;
                buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å"
            buyButton.addEventListener('click', () => {
                if (!buyButton.disabled) {
                    if (testBalance < CARD_COST) {
                        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!");
                        return;
                    }
                    
                    updateBalance(-CARD_COST);
                    
                    buyButton.disabled = true;
                    buyButton.textContent = '–°—Ç–∏—Ä–∞–π—Ç–µ —è—á–µ–π–∫–∏...';
                    
                    generateNewCard();
                }
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            updateBalance(0);
            showNextCardPrompt(); 
        });
    </script>
</body>
</html>