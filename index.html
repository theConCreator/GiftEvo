<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plinko Mania Extreme</title>
    <style>
        :root {
            --bg: #050508;
            --primary: #00ffcc;
            --accent: #ff00ff;
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Arial Black', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; min-height: 100vh; overflow: hidden;
        }

        #game-wrapper { position: relative; transition: transform 0.1s; }

        .stats {
            display: flex; gap: 20px; margin-bottom: 10px;
            font-size: 1.5rem; text-shadow: 0 0 10px var(--primary);
        }

        canvas {
            background: #0a0a1a; border: 3px solid #1a1a3a;
            border-radius: 20px; box-shadow: 0 0 50px rgba(0,0,0,1);
            max-width: 100vw; max-height: 70vh;
        }

        .btn-panel {
            margin-top: 15px; display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center;
        }

        button {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none; padding: 15px 50px; border-radius: 15px;
            color: white; font-weight: bold; font-size: 1.2rem;
            cursor: pointer; box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
            transition: 0.2s; text-transform: uppercase;
        }

        button:active { transform: scale(0.95); filter: brightness(1.2); }

        .last-win {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 3rem; pointer-events: none; opacity: 0; color: gold;
        }

        @keyframes winPop {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(1.5); }
        }
    </style>
</head>
<body>

    <div class="stats">
        <div>üí∞ $<span id="balance">500</span></div>
    </div>

    <div id="game-wrapper">
        <canvas id="plinko"></canvas>
        <div id="win-text" class="last-win">BIG WIN!</div>
    </div>

    <div class="btn-panel">
        <button id="dropBtn">–ó–ê–ü–£–°–ö ($10)</button>
    </div>

    <script>
        const canvas = document.getElementById('plinko');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('game-wrapper');
        const winText = document.getElementById('win-text');
        
        let balance = 500;
        let particles = [];
        let balls = [];
        let pegs = [];
        const rows = 11;
        const multis = [10, 3, 1.5, 0.5, 0.2, 0.5, 1.5, 3, 10];

        function resize() {
            canvas.width = Math.min(window.innerWidth - 30, 450);
            canvas.height = canvas.width * 1.3;
            initPegs();
        }

        function initPegs() {
            pegs = [];
            const spacing = canvas.width / (rows + 1);
            for (let i = 2; i < rows; i++) {
                for (let j = 0; j <= i; j++) {
                    pegs.push({
                        x: (canvas.width / 2) + (j - i / 2) * spacing,
                        y: 70 + i * (spacing * 0.9),
                        r: 4, light: 0
                    });
                }
            }
        }

        function createParticles(x, y, color) {
            for(let i=0; i<8; i++) {
                particles.push({
                    x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                    life: 1, color
                });
            }
        }

        function shake() {
            wrapper.style.transform = `translate(${(Math.random()-0.5)*10}px, ${(Math.random()-0.5)*10}px)`;
            setTimeout(() => wrapper.style.transform = 'translate(0,0)', 50);
        }

        function dropBall() {
            if (balance < 10) return;
            balance -= 10;
            document.getElementById('balance').innerText = balance;
            
            balls.push({
                x: canvas.width / 2 + (Math.random()*4-2),
                y: 20, vx: 0, vy: 0, r: 10,
                hits: 0, color: '#fff'
            });
        }

        function update() {
            // –ß–∞—Å—Ç–∏—Ü—ã
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                if(p.life <= 0) particles.splice(i, 1);
            });

            balls.forEach((b, i) => {
                b.vy += 0.3; b.x += b.vx; b.y += b.vy;
                
                // –ö–æ–ª—ã—à–∫–∏
                pegs.forEach(p => {
                    const dx = b.x - p.x, dy = b.y - p.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < b.r + p.r) {
                        b.hits++;
                        p.light = 1;
                        const angle = Math.atan2(dy, dx);
                        b.vx = Math.cos(angle) * 5 + (Math.random()-0.5);
                        b.vy = Math.sin(angle) * 5;
                        b.x = p.x + Math.cos(angle)*(b.r+p.r);
                        b.y = p.y + Math.sin(angle)*(b.r+p.r);
                        // –¶–≤–µ—Ç —à–∞—Ä–∞ –º–µ–Ω—è–µ—Ç—Å—è –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ö–∏—Ç–æ–≤
                        b.color = `hsl(${b.hits * 20}, 100%, 60%)`;
                    }
                });

                // –°—Ç–µ–Ω–∫–∏
                if(b.x < b.r || b.x > canvas.width - b.r) b.vx *= -0.6;

                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –ª—É–∑—É
                if(b.y > canvas.height - 30) {
                    const idx = Math.floor((b.x / canvas.width) * multis.length);
                    const win = 10 * multis[idx];
                    balance += win;
                    document.getElementById('balance').innerText = Math.floor(balance);
                    
                    if(multis[idx] >= 3) {
                        shake();
                        winText.style.animation = 'none';
                        setTimeout(() => winText.style.animation = 'winPop 0.8s ease-out', 10);
                        createParticles(b.x, b.y, '#ffcc00');
                    }
                    balls.splice(i, 1);
                }
            });

            pegs.forEach(p => p.light *= 0.9);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –õ—É–∑—ã
            const bw = canvas.width / multis.length;
            multis.forEach((m, i) => {
                ctx.fillStyle = m >= 3 ? '#ff0055' : '#1a1a3a';
                ctx.fillRect(i*bw + 2, canvas.height - 40, bw - 4, 35);
                ctx.fillStyle = "white";
                ctx.font = "bold 12px Arial";
                ctx.textAlign = "center";
                ctx.fillText(`x${m}`, i*bw + bw/2, canvas.height - 18);
            });

            // –ö–æ–ª—ã—à–∫–∏
            pegs.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, 7);
                ctx.fillStyle = `rgb(${40 + p.light*215}, ${40 + p.light*215}, ${80 + p.light*175})`;
                if(p.light > 0.5) { ctx.shadowBlur = 10; ctx.shadowColor = "#fff"; }
                ctx.fill();
                ctx.shadowBlur = 0;
            });

            // –ß–∞—Å—Ç–∏—Ü—ã
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 3, 3);
            });
            ctx.globalAlpha = 1;

            // –®–∞—Ä—ã
            balls.forEach(b => {
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.r, 0, 7);
                ctx.fillStyle = b.color;
                ctx.shadowBlur = 15; ctx.shadowColor = b.color;
                ctx.fill();
                ctx.shadowBlur = 0;
            });

            requestAnimationFrame(() => { update(); draw(); });
        }

        document.getElementById('dropBtn').onclick = dropBall;
        window.onresize = resize;
        resize();
        draw();
    </script>
</body>
</html>