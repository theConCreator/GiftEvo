<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Falling Tools</title>
    <style>
        body {
            background: #000;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: sans-serif;
        }

        #game-container {
            width: 350px;
            height: 700px;
            background: #222;
            position: relative;
            border: 4px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å 3x5 */
        #inventory {
            margin-top: 50px;
            background: #8B8B8B;
            border: 4px solid #373737;
            display: grid;
            grid-template-columns: repeat(5, 54px);
            grid-template-rows: repeat(3, 54px);
            gap: 2px;
            padding: 4px;
            box-shadow: inset -3px -3px 0 #555, inset 3px 3px 0 #FFF;
            z-index: 10;
        }

        .slot {
            background: #8B8B8B;
            border: 2px solid #373737;
            box-shadow: inset -2px -2px 0 #545454;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            width: 50px;
            height: 50px;
            box-sizing: border-box;
        }

        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        #world {
            position: relative;
            width: 280px; /* 5 –∫–æ–ª–æ–Ω–æ–∫ –ø–æ 54px + –∑–∞–∑–æ—Ä—ã */
            height: 400px;
            margin-top: 20px;
            overflow: visible;
        }

        .block {
            position: absolute;
            width: 54px;
            height: 54px;
            border: 2px solid rgba(0,0,0,0.2);
            box-sizing: border-box;
            image-rendering: pixelated;
        }

        .falling-tool {
            position: absolute;
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            z-index: 100;
            pointer-events: none;
        }

        /* –¢–µ–∫—Å—Ç—É—Ä—ã */
        .stone { background: #7a7a7a; border-bottom: 4px solid #444; }
        .dirt { background: #866043; border-bottom: 4px solid #5d4037; }
        .gold { background: #7a7a7a; border: 4px solid #ffd700; }
        .chest { background: #a0522d; border: 4px solid #5d2f0d; }

        #spin-btn {
            position: absolute;
            bottom: 40px;
            width: 180px;
            height: 50px;
            background: #5c9e31;
            border: none;
            border-bottom: 4px solid #3a631f;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
        }

        #spin-btn:active { transform: translateY(2px); border-bottom-width: 2px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="inventory" id="inv-grid">
        </div>

    <div id="world"></div>

    <button id="spin-btn">–ö–†–£–¢–ò–¢–¨</button>
</div>

<script>
    const inv = document.getElementById('inventory');
    const world = document.getElementById('world');
    const btn = document.getElementById('spin-btn');

    const COLS = 5;
    const ROWS = 6;
    const BLOCK_SIZE = 54;
    const GRAVITY = 0.6;

    let blocks = [[], [], [], [], []];
    let isPlaying = false;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤
    for (let i = 0; i < 15; i++) {
        const slot = document.createElement('div');
        slot.className = 'slot';
        inv.appendChild(slot);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–æ–≤
    function initBlocks() {
        for (let c = 0; c < COLS; c++) {
            for (let r = 0; r < ROWS; r++) {
                spawnBlock(c, r * BLOCK_SIZE);
            }
        }
    }

    function spawnBlock(col, y, isNew = false) {
        const types = ['stone', 'stone', 'dirt', 'gold', 'chest'];
        const type = types[Math.floor(Math.random() * types.length)];
        const el = document.createElement('div');
        el.className = `block ${type}`;
        
        const block = {
            el,
            x: col * BLOCK_SIZE,
            y: isNew ? -BLOCK_SIZE : y,
            vy: 0,
            type
        };
        
        world.appendChild(el);
        blocks[col].push(block);
        updateBlockPos(block);
    }

    function updateBlockPos(b) {
        b.el.style.left = b.x + 'px';
        b.el.style.top = b.y + 'px';
    }

    // –§–∏–∑–∏—á–µ—Å–∫–∏–π —Ü–∏–∫–ª
    function update() {
        blocks.forEach((col, cIdx) => {
            col.forEach((b, rIdx) => {
                const targetY = (ROWS - 1 - rIdx) * BLOCK_SIZE;
                if (b.y < targetY) {
                    b.vy += GRAVITY;
                    b.y += b.vy;
                    if (b.y >= targetY) {
                        b.y = targetY;
                        b.vy = 0;
                    }
                }
                updateBlockPos(b);
            });
            // –î–æ—Å–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
            if (col.length < ROWS) {
                spawnBlock(cIdx, 0, true);
            }
        });
        requestAnimationFrame(update);
    }

    // –õ–æ–≥–∏–∫–∞ –ø–∞–¥–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    async function dropTool(type, colIndex) {
        return new Promise(resolve => {
            const toolEl = document.createElement('div');
            toolEl.className = 'falling-tool';
            toolEl.innerText = type;
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è - –Ω–∞–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–æ–π
            const startX = colIndex * BLOCK_SIZE;
            const startY = -150; // –í—ã–ª–µ—Ç–∞–µ—Ç "–∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è"
            
            toolEl.style.left = startX + 'px';
            toolEl.style.top = startY + 'px';
            world.appendChild(toolEl);

            let ty = startY;
            let tvy = 0;

            function fall() {
                tvy += GRAVITY * 1.5;
                ty += tvy;
                toolEl.style.top = ty + 'px';

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –≤–µ—Ä—Ö–Ω–∏–º –±–ª–æ–∫–æ–º –∫–æ–ª–æ–Ω–∫–∏
                const topBlock = blocks[colIndex][blocks[colIndex].length - 1];
                if (topBlock && ty + 30 >= topBlock.y) {
                    destroyBlock(colIndex);
                    toolEl.remove();
                    resolve();
                    return;
                }

                // –ï—Å–ª–∏ –ø—Ä–æ–ª–µ—Ç–µ–ª –º–∏–º–æ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
                if (ty > 600) {
                    toolEl.remove();
                    resolve();
                    return;
                }
                requestAnimationFrame(fall);
            }
            fall();
        });
    }

    function destroyBlock(colIndex) {
        const col = blocks[colIndex];
        if (col.length > 0) {
            const b = col.pop(); // –£–¥–∞–ª—è–µ–º –≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫
            b.el.style.transform = 'scale(1.5)';
            b.el.style.opacity = '0';
            setTimeout(() => b.el.remove(), 100);
        }
    }

    btn.onclick = async () => {
        if (isPlaying) return;
        isPlaying = true;

        const tools = ['‚õèÔ∏è', 'üí£', 'TNT', ''];
        const slots = document.querySelectorAll('.slot');
        let results = [];

        // 1. –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª–æ—Ç—ã
        slots.forEach(s => {
            const res = Math.random() > 0.7 ? tools[Math.floor(Math.random() * tools.length)] : '';
            s.innerText = res;
            results.push(res);
        });

        // 2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–∞–¥–∞—é—Ç –ø–æ —Ä—è–¥–∞–º
        for (let r = 0; r < 3; r++) {
            const rowDrops = [];
            for (let c = 0; c < 5; c++) {
                const type = results[r * 5 + c];
                if (type) {
                    rowDrops.push(dropTool(type, c));
                }
            }
            if (rowDrops.length > 0) {
                await Promise.all(rowDrops);
                await new Promise(res => setTimeout(res, 200));
            }
        }

        isPlaying = false;
    };

    initBlocks();
    update();
</script>

</body>
</html>