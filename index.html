<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Падающая Кирка - Minecraft Arcade</title>
    <style>
        /* CSS Стили */
        body {
            background-color: #282c34;
            color: #fff;
            font-family: 'Courier New', monospace; /* Используем моноширинный шрифт для "ретро" стиля */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            display: flex;
            flex-direction: row;
            border: 5px solid #000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            background-color: #444; 
        }

        #info-panel {
            width: 150px; /* Боковая панель для ресурсов, как на скриншоте */
            background-color: #333;
            padding: 10px;
            text-align: left;
            border-right: 2px solid #000;
        }

        #info-panel h3 {
            margin-top: 0;
            text-align: center;
        }

        .resource-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .resource-color {
            width: 14px;
            height: 14px;
            margin-right: 8px;
            border: 1px solid #111;
        }

        #game-canvas {
            display: block; 
            background-color: #6d6d6d; /* Фоновый цвет шахты */
        }
    </style>
</head>
<body>

    <h1>⛏️ Падающая Кирка</h1>

    <div id="game-container">
        <div id="info-panel">
            <h3>Ресурсы:</h3>
            <div class="resource-item"><div class="resource-color" style="background-color: #555555;"></div>Уголь: <span id="coal-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #9d9d9d;"></div>Железо: <span id="iron-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #ffcc00;"></div>Золото: <span id="gold-count">0</span></div>
            <div class="resource-item"><div class="resource-color" style="background-color: #66ffff;"></div>Алмазы: <span id="diamond-count">0</span></div>
        </div>
        
        <canvas id="game-canvas"></canvas>
    </div>
    
    <button onclick="startGame()" style="margin-top: 20px; padding: 10px 20px; font-size: 1.2em;">Запустить Кирку!</button>

    <script>
        // JavaScript Логика Игры
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const button = document.querySelector('button');

        // --- Константы ---
        const BLOCK_SIZE = 32; 
        const GAME_WIDTH = 15; // Ширина игрового поля в блоках
        const GAME_HEIGHT = 20; // Высота игрового поля в блоках
        const MAX_HORIZONTAL_JUMP = 3; // Максимальный горизонтальный сдвиг при ударе

        canvas.width = GAME_WIDTH * BLOCK_SIZE;
        canvas.height = GAME_HEIGHT * BLOCK_SIZE;

        // --- Типы Блоков ---
        const BLOCK_TYPES = {
            AIR: 0,
            STONE: 1,
            COAL: 2,
            IRON: 3,
            GOLD: 4,
            DIAMOND: 5,
        };

        const BLOCK_COLORS = {
            [BLOCK_TYPES.STONE]: '#a0a0a0',
            [BLOCK_TYPES.COAL]: '#555555',
            [BLOCK_TYPES.IRON]: '#c7c7c7',
            [BLOCK_TYPES.GOLD]: '#ffcc00',
            [BLOCK_TYPES.DIAMOND]: '#66ffff'
        };

        // --- Состояние Игры ---
        let gameGrid = [];
        let pickaxe = {
            x: 7, 
            y: -1, // Начинаем над полем
            vy: 0, // Вертикальная скорость (пикселей в кадр)
            vx: 0, // Горизонтальная скорость
            speed: 5 // Базовая скорость падения
        };
        let resources = {
            [BLOCK_TYPES.COAL]: 0,
            [BLOCK_TYPES.IRON]: 0,
            [BLOCK_TYPES.GOLD]: 0,
            [BLOCK_TYPES.DIAMOND]: 0
        };
        let gameInterval = null;

        // --- Функции Инициализации ---

        function generateInitialGrid() {
            gameGrid = [];
            for (let y = 0; y < GAME_HEIGHT; y++) {
                gameGrid[y] = [];
                for (let x = 0; x < GAME_WIDTH; x++) {
                    gameGrid[y][x] = BLOCK_TYPES.STONE; 
                    
                    // Распределение руд по глубине
                    if (y > 3) {
                        const rand = Math.random();
                        if (y > 15 && rand < 0.03) gameGrid[y][x] = BLOCK_TYPES.DIAMOND;
                        else if (y > 10 && rand < 0.08) gameGrid[y][x] = BLOCK_TYPES.GOLD;
                        else if (y > 5 && rand < 0.15) gameGrid[y][x] = BLOCK_TYPES.IRON;
                        else if (rand < 0.3) gameGrid[y][x] = BLOCK_TYPES.COAL;
                    }
                    // Верхние 3 ряда - пустота или грязь (светлый камень)
                    if (y < 3) gameGrid[y][x] = BLOCK_TYPES.AIR;
                }
            }
        }

        function resetPickaxe() {
            pickaxe.x = Math.floor(GAME_WIDTH / 2);
            pickaxe.y = 0;
            pickaxe.vy = pickaxe.speed;
            pickaxe.vx = 0;
        }

        function startGame() {
            if (gameInterval) return; // Игра уже запущена
            generateInitialGrid();
            resetPickaxe();
            // Сброс ресурсов для новой игры
            Object.keys(resources).forEach(key => resources[key] = 0);
            updateResourcesDisplay();
            button.disabled = true;
            button.innerText = "Кирка в работе...";
            
            // Запуск игрового цикла
            gameInterval = setInterval(gameLoop, 1000 / 60); // 60 кадров в секунду
        }

        // --- Отрисовка ---

        function drawBlock(x, y, type) {
            if (type === BLOCK_TYPES.AIR) return;

            ctx.fillStyle = BLOCK_COLORS[type] || '#555';
            ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            
            // Пиксельные детали (текстура)
            ctx.strokeStyle = '#00000033'; 
            ctx.lineWidth = 1;
            ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            
            // Добавим немного рандомных точек для вида руды
            if (type !== BLOCK_TYPES.STONE) {
                ctx.fillStyle = 'black';
                for (let i = 0; i < 4; i++) {
                    ctx.fillRect(
                        x * BLOCK_SIZE + Math.floor(Math.random() * BLOCK_SIZE), 
                        y * BLOCK_SIZE + Math.floor(Math.random() * BLOCK_SIZE), 
                        2, 2
                    );
                }
            }
        }

        function drawPickaxe() {
            // Рисуем кирку (имитация спрайта)
            const px = pickaxe.x * BLOCK_SIZE;
            const py = pickaxe.y * BLOCK_SIZE;

            // Рукоятка (коричневая)
            ctx.fillStyle = '#964b00'; 
            ctx.fillRect(px + BLOCK_SIZE * 0.7, py + BLOCK_SIZE * 0.1, BLOCK_SIZE * 0.2, BLOCK_SIZE * 0.8);
            
            // Лезвие (железное/серое)
            ctx.fillStyle = '#b3b3b3'; 
            ctx.beginPath();
            ctx.moveTo(px, py + BLOCK_SIZE * 0.2); // Левый верхний угол лезвия
            ctx.lineTo(px + BLOCK_SIZE * 0.75, py + BLOCK_SIZE * 0.1); // Середина рукоятки (верх)
            ctx.lineTo(px + BLOCK_SIZE * 0.85, py + BLOCK_SIZE * 0.3); // Правый край
            ctx.lineTo(px + BLOCK_SIZE * 0.75, py + BLOCK_SIZE * 0.5); // Середина рукоятки (низ)
            ctx.lineTo(px, py + BLOCK_SIZE * 0.4); // Левый нижний угол
            ctx.fill();

            // Маленький блик
            ctx.fillStyle = 'white';
            ctx.fillRect(px + 2, py + 2, 2, 2);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Отрисовка сетки блоков
            for (let y = 0; y < GAME_HEIGHT; y++) {
                for (let x = 0; x < GAME_WIDTH; x++) {
                    drawBlock(x, y, gameGrid[y][x]);
                }
            }

            // Отрисовка кирки
            drawPickaxe();
        }

        // --- Игровая Логика ---

        function updateResourcesDisplay() {
            document.getElementById('coal-count').innerText = resources[BLOCK_TYPES.COAL];
            document.getElementById('iron-count').innerText = resources[BLOCK_TYPES.IRON];
            document.getElementById('gold-count').innerText = resources[BLOCK_TYPES.GOLD];
            document.getElementById('diamond-count').innerText = resources[BLOCK_TYPES.DIAMOND];
        }

        function update() {
            // 1. Обновление позиции
            pickaxe.y += pickaxe.vy / BLOCK_SIZE; // Перемещаемся в блоках
            pickaxe.x += pickaxe.vx / BLOCK_SIZE;
            
            // Проверка границ по горизонтали
            if (pickaxe.x < 0) {
                pickaxe.x = 0;
                pickaxe.vx *= -1; // Отскок от левой стены
            }
            if (pickaxe.x > GAME_WIDTH - 1) {
                pickaxe.x = GAME_WIDTH - 1;
                pickaxe.vx *= -1; // Отскок от правой стены
            }

            // 2. Проверка столкновений (только с блоком под киркой)
            const targetY = Math.round(pickaxe.y + 0.5); // Блок, который находится прямо под центром кирки
            const targetX = Math.round(pickaxe.x);

            if (targetY >= 0 && targetY < GAME_HEIGHT) {
                const blockType = gameGrid[targetY][targetX];

                if (blockType !== BLOCK_TYPES.AIR) {
                    // Столкновение!
                    
                    // a) Добыча ресурса
                    if (resources[blockType] !== undefined) {
                        resources[blockType]++;
                        updateResourcesDisplay();
                    }

                    // b) Удаление блока
                    gameGrid[targetY][targetX] = BLOCK_TYPES.AIR;
                    
                    // c) Отскок (имитация прыжка и сдвига)
                    // Вертикальный отскок
                    pickaxe.vy = pickaxe.speed; // Сброс скорости вниз для продолжения падения
                    
                    // Горизонтальный "прыжок"
                    const jumpDirection = (Math.random() < 0.5) ? -1 : 1;
                    // Случайный горизонтальный сдвиг, чтобы кирка не падала строго вертикально
                    pickaxe.vx = jumpDirection * (Math.random() * MAX_HORIZONTAL_JUMP + 1); 
                }
            }
            
            // 3. Добавление гравитации (постепенное увеличение скорости)
            pickaxe.vy += 0.2; 
            
            // 4. Завершение/Рестарт игры
            if (pickaxe.y > GAME_HEIGHT) {
                clearInterval(gameInterval);
                gameInterval = null;
                button.disabled = false;
                button.innerText = "Игра окончена! Запустить снова.";
                pickaxe.isFalling = false;
                alert("Кирка упала на дно мира! Ваши ресурсы: " + resources[BLOCK_TYPES.DIAMOND] + " алмазов.");
            }
        }

        function gameLoop() {
            update();
            draw();
        }

        // Инициализация при загрузке страницы
        generateInitialGrid();
        resetPickaxe();
        draw(); // Первоначальная отрисовка
    </script>

</body>
</html>
