<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Web App Game</title>
    <style>
        /* --- 1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a; 
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            height: calc(100vh - 120px); /* –í—ã—Å–æ—Ç–∞ –º–∏–Ω—É—Å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
            overflow-y: scroll; 
            background-color: #2c2c2c;
            border-left: 2px solid #555;
            border-right: 2px solid #555;
            position: relative; 
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch; 
        }

        /* --- 2. –°—Ç–∏–ª—å –ê—Ä–µ–Ω—ã –∏ –ë–ª–æ–∫–æ–≤ --- */
        #arena {
            display: grid;
            /* –ò–∑–º–µ–Ω–µ–Ω–æ: 1fr —Å—Ç–µ–Ω–∞ (—É–∑–∫–∞—è) | 6 –∫–æ–ª–æ–Ω–æ–∫ –±–ª–æ–∫–æ–≤ (–ø–æ 50px) | 1fr —Å—Ç–µ–Ω–∞ (—É–∑–∫–∞—è) */
            grid-template-columns: 1fr repeat(6, 50px) 1fr; 
            grid-auto-rows: 50px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –±–ª–æ–∫–∞ */
            min-height: 100%; /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∞—Ä–µ–Ω–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω–∏–º—É–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }

        /* –ë–æ–∫–æ–≤—ã–µ —Å—Ç–µ–Ω—ã */
        .wall {
            background-color: #333;
            border: 1px solid #444;
            opacity: 0.9;
        }
        .wall.left {
            grid-column: 1 / 2;
        }
        .wall.right {
            grid-column: 8 / 9;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –±–ª–æ–∫–∞ */
        .block {
            width: 50px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            height: 50px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            border: 1px solid black;
            box-sizing: border-box;
            text-align: center;
            line-height: 48px; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
            font-size: 12px;
            font-weight: bold;
            color: #eee;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
        }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤ */
        .block-dirt { background-color: #8b572a; border-color: #633e1e; }
        .block-stone { background-color: #808080; border-color: #5d5d5d; }
        .block-diamond { 
            background-color: #4682b4; 
            border-color: #316089; 
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.7);
            color: white;
        }

        /* --- 3. –°—Ç–∏–ª—å –ö–∏—Ä–∫–∏ (–§–∏–∑–∏—á–µ—Å–∫–∏–π –û–±—ä–µ–∫—Ç) --- */
        #pickaxe {
            width: 40px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∏—Ä–∫–∏ */
            height: 40px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∏—Ä–∫–∏ */
            background-color: #ffd700; 
            border-radius: 5px;
            position: absolute; 
            top: -100px; 
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
            display: none; 
            text-align: center;
            line-height: 40px;
            font-size: 20px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏ */
            z-index: 10;
        }

        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–∏—Ä–∫–∏ */
        .pickaxe-wood { background-color: #a0522d; }
        .pickaxe-iron { background-color: #808080; }
        .pickaxe-diamond { background-color: #00bcd4; box-shadow: 0 0 10px rgba(0, 255, 255, 0.7); }

        /* --- 4. –≠–ª–µ–º–µ–Ω—Ç—ã –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–û—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏) --- */
        #controls {
            padding: 10px;
            width: 100%;
            max-width: 600px;
            background-color: #2b2b2b;
            text-align: center;
            position: fixed; 
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
            box-sizing: border-box;
            z-index: 20;
        }

        .pickaxe-button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
        }
        .pickaxe-button:active {
            transform: scale(0.98);
        }

        .pickaxe-button[data-type="wood"] { background-color: #9c5e3d; color: white; }
        .pickaxe-button[data-type="iron"] { background-color: #6a6a6a; color: white; }
        .pickaxe-button[data-type="diamond"] { background-color: #00bcd4; color: #1a1a1a; }

        #message {
            margin-top: 5px;
            min-height: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="pickaxe">‚õèÔ∏è</div> 
        
        <div id="arena">
            </div>
    </div>

    <div id="controls">
        <h3>üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance">1000</span></h3>
        <p>–ö—É–ø–∏—Ç–µ –∫–∏—Ä–∫—É:</p>
        <button class="pickaxe-button" data-type="wood" data-price="100">–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è (100)</button>
        <button class="pickaxe-button" data-type="iron" data-price="500">–ñ–µ–ª–µ–∑–Ω–∞—è (500)</button>
        <button class="pickaxe-button" data-type="diamond" data-price="2000">–ê–ª–º–∞–∑–Ω–∞—è (2000)</button>
        <p id="message">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∏—Ä–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!</p>
    </div>
    
    <script>
        // --- 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–û–ë–ù–û–í–õ–ï–ù–´) ---
        const Telegram = window.Telegram ? window.Telegram.WebApp : null;
        if (Telegram) Telegram.ready();
        
        const ARENA_WIDTH_BLOCKS = 6;
        const BLOCK_SIZE_PX = 50; // –ù–û–í–´–ô –†–ê–ó–ú–ï–† –ë–õ–û–ö–ê
        const PICKAXE_SIZE_PX = 40; // –ù–û–í–´–ô –†–ê–ó–ú–ï–† –ö–ò–†–ö–ò
        const WALL_WIDTH_PX = 30; // –£–ó–ö–ê–Ø –°–¢–ï–ù–ê (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 1fr –∏–∑ CSS)
        const GAME_WIDTH_PX = (ARENA_WIDTH_BLOCKS * BLOCK_SIZE_PX) + (2 * WALL_WIDTH_PX);

        const arena = document.getElementById('arena');
        const pickaxeElement = document.getElementById('pickaxe');
        const gameContainer = document.getElementById('game-container');
        const balanceElement = document.getElementById('balance');
        const messageElement = document.getElementById('message');
        
        const GRAVITY = 0.5; 
        const INITIAL_SPEED_MAX = 8; 

        let playerBalance = 1000;
        let activePickaxe = null; 
        let lastTime = 0;

        // --- 2. –ö–ª–∞—Å—Å –ö–∏—Ä–∫–∏ (–§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å) ---
        class Pickaxe {
            constructor(type) {
                this.type = type;
                this.element = pickaxeElement;
                this.width = PICKAXE_SIZE_PX;
                this.height = PICKAXE_SIZE_PX;
                
                // –†–∞–Ω–¥–æ–º–Ω–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è X –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∞—Ä–µ–Ω—ã
                const arenaInnerWidth = GAME_WIDTH_PX - 2 * WALL_WIDTH_PX - this.width;
                this.x = WALL_WIDTH_PX + (Math.random() * arenaInnerWidth);
                
                // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è Y: –ù–ï–ú–ù–û–ì–û –≤—ã—à–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–µ—Ä—Ö–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                this.y = gameContainer.scrollTop - PICKAXE_SIZE_PX; 
                
                // –†–∞–Ω–¥–æ–º–Ω–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–≤–∫–ª—é—á–∞—è –Ω–µ–±–æ–ª—å—à—É—é –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å)
                this.vx = (Math.random() * INITIAL_SPEED_MAX * 2) - INITIAL_SPEED_MAX; 
                this.vy = -(Math.random() * INITIAL_SPEED_MAX / 2); 
                
                this.element.className = `pickaxe-placeholder pickaxe-${type}`;
                this.element.style.width = `${this.width}px`;
                this.element.style.height = `${this.height}px`;
                this.element.style.lineHeight = `${this.height}px`;
                this.element.style.display = 'block';
                this.updateDOM();
            }

            updateDOM() {
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
            }

            update(deltaTime) {
                this.vy += GRAVITY * deltaTime; 
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;

                // 2. –ö–æ–ª–ª–∏–∑–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
                const minX = WALL_WIDTH_PX;
                const maxX = GAME_WIDTH_PX - WALL_WIDTH_PX - this.width;

                if (this.x < minX) {
                    this.x = minX;
                    this.vx *= -0.7;
                } else if (this.x > maxX) {
                    this.x = maxX;
                    this.vx *= -0.7;
                }
                
                // 3. –ö–æ–ª–ª–∏–∑–∏—è —Å –±–ª–æ–∫–∞–º–∏
                if (this.y + this.height > gameContainer.scrollTop) { // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∫–∏—Ä–∫–∞ –≤—Ö–æ–¥–∏—Ç –≤ –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å
                    const blockHit = this.checkCollisionWithBlocks();
                    if (blockHit) {
                        this.handleHit(blockHit);
                        return false; 
                    }
                }
                
                this.updateDOM();
                return true; 
            }
            
            checkCollisionWithBlocks() {
                const relativeX = this.x - WALL_WIDTH_PX + (this.width / 2);
                const colIndex = Math.floor(relativeX / BLOCK_SIZE_PX);
                
                const rowIndex = Math.floor((this.y + this.height) / BLOCK_SIZE_PX); 

                const blockElement = arena.querySelector(`[data-row="${rowIndex}"][data-col="${colIndex}"]`);

                if (blockElement) {
                    const blockRect = blockElement.getBoundingClientRect();
                    const containerRect = gameContainer.getBoundingClientRect();
                    
                    const blockY = blockRect.top - containerRect.top + gameContainer.scrollTop; 
                    
                    if (this.y + this.height > blockY) {
                         return blockElement;
                    }
                }
                return null;
            }

            handleHit(blockElement) {
                const dataToSend = { 
                    action: 'mine', 
                    row: blockElement.dataset.row, 
                    col: blockElement.dataset.col, 
                    pickaxe: this.type 
                };
                
                messageElement.textContent = `üí• –ö–∏—Ä–∫–∞ ${this.type} —É–¥–∞—Ä–∏–ª–∞ –±–ª–æ–∫ (${blockElement.textContent})! –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...`;
                
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Ç—Å–∫–æ–∫
                this.vy = -this.vy * 0.4; 
                this.vx *= 0.3; 

                // –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è –±–ª–æ–∫–∞ 
                if (blockElement.classList.contains('block-diamond') || Math.random() < 0.2) {
                     blockElement.style.opacity = 0;
                     setTimeout(() => blockElement.remove(), 200);
                     messageElement.textContent += " –ë–ª–æ–∫ —Å–ª–æ–º–∞–Ω (—Å–∏–º—É–ª—è—Ü–∏—è)!";
                } else {
                     messageElement.textContent += " –ë–ª–æ–∫ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—á–Ω—ã–π. –ö–∏—Ä–∫–∞ –æ—Ç—Å–∫–æ—á–∏–ª–∞.";
                }
                
                this.element.style.display = 'none';
                activePickaxe = null; 
            }
        }
        
        // --- 3. –ò–≥—Ä–æ–≤–æ–π –¶–∏–∫–ª ---
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastTime) / 16.67; 
            lastTime = currentTime;
            
            if (activePickaxe) {
                const isActive = activePickaxe.update(Math.min(deltaTime, 3)); 
                
                // –ï—Å–ª–∏ –∫–∏—Ä–∫–∞ —É–ø–∞–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –≤–Ω–∏–∑ (–≤–Ω–µ –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è)
                if (!isActive || activePickaxe.y > gameContainer.scrollTop + gameContainer.clientHeight + 300) {
                     activePickaxe = null;
                     pickaxeElement.style.display = 'none';
                     messageElement.textContent = "–ö–∏—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Å–≤–æ–π –ø–æ–ª—ë—Ç.";
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // --- 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ê—Ä–µ–Ω—ã –∏ –õ–æ–≥–∏–∫–∞ –ö–Ω–æ–ø–æ–∫ ---
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ–≥–æ 10 —Ä—è–¥–æ–≤ –≤ –Ω–∞—á–∞–ª–µ!
        const INITIAL_ROWS = 10; 
        
        function generateInitialArena(rows) {
            for (let r = 0; r < rows; r++) {
                const wallLeft = document.createElement('div');
                wallLeft.className = 'wall left';
                arena.appendChild(wallLeft);
                
                for (let c = 0; c < ARENA_WIDTH_BLOCKS; c++) {
                    const block = document.createElement('div');
                    
                    const rand = Math.random();
                    let blockType;
                    if (rand < 0.1) blockType = 'diamond';
                    else if (rand < 0.6) blockType = 'dirt';
                    else blockType = 'stone';
                    
                    block.className = `block block-${blockType}`;
                    block.textContent = r > 20 ? '' : blockType.toUpperCase();
                    block.dataset.row = r;
                    block.dataset.col = c;
                    
                    arena.appendChild(block);
                }
                
                const wallRight = document.createElement('div');
                wallRight.className = 'wall right';
                arena.appendChild(wallRight);
            }
        }
        
        document.querySelectorAll('.pickaxe-button').forEach(button => {
            button.addEventListener('click', () => {
                if (activePickaxe) {
                    messageElement.textContent = 'üõë –î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ –∫–∏—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç –±—Ä–æ—Å–æ–∫!';
                    return;
                }
                
                const price = parseInt(button.dataset.price);
                const type = button.dataset.type;
                
                if (playerBalance >= price) {
                    playerBalance -= price;
                    balanceElement.textContent = playerBalance;
                    
                    activePickaxe = new Pickaxe(type);
                    messageElement.textContent = `üöÄ ${type.toUpperCase()} –∫–∏—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!`;
                } else {
                    messageElement.textContent = `üö´ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ (${price - playerBalance} –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç).`;
                }
            });
        });
        
        // --- 5. –ó–∞–ø—É—Å–∫ ---
        generateInitialArena(INITIAL_ROWS); 
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>