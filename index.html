<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Web App Game</title>
    <style>
        /* --- 1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a; 
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            height: calc(100vh - 120px); 
            overflow-y: scroll; 
            background-color: #2c2c2c;
            border-left: 2px solid #555;
            border-right: 2px solid #555;
            position: relative; 
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch; 
        }

        /* --- 2. –°—Ç–∏–ª—å –ê—Ä–µ–Ω—ã –∏ –ë–ª–æ–∫–æ–≤ (50px) --- */
        #arena {
            display: grid;
            grid-template-columns: 1fr repeat(6, 50px) 1fr; 
            grid-auto-rows: 50px; 
            min-height: 100%; 
        }

        /* –ë–æ–∫–æ–≤—ã–µ —Å—Ç–µ–Ω—ã */
        .wall {
            background-color: #333;
            border: 1px solid #444;
            opacity: 0.9;
        }
        .wall.left { grid-column: 1 / 2; }
        .wall.right { grid-column: 8 / 9; }

        .block {
            width: 50px; 
            height: 50px; 
            border: 1px solid black;
            box-sizing: border-box;
            text-align: center;
            line-height: 48px; 
            font-size: 10px;
            font-weight: bold;
            color: #eee;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.4);
            transition: opacity 0.2s;
        }
        
        /* 7 –¢–ò–ü–û–í –ë–õ–û–ö–û–í */
        .block-dirt { background-color: #8b572a; border-color: #633e1e; }
        .block-stone { background-color: #808080; border-color: #5d5d5d; }
        .block-coal { background-color: #36454F; border-color: #2b363c; } 
        .block-iron { background-color: #C0C0C0; border-color: #a0a0a0; } 
        .block-gold { background-color: #FFD700; border-color: #ccac00; color: #1a1a1a; } 
        .block-diamond { background-color: #4682b4; border-color: #316089; box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.7); } 
        .block-emerald { background-color: #50C878; border-color: #3a9757; } 
        
        .mined {
            opacity: 0 !important; 
            pointer-events: none; 
        }

        /* --- 3. –°—Ç–∏–ª—å –ö–∏—Ä–∫–∏ (–í—Ä–∞—â–µ–Ω–∏–µ) --- */
        #pickaxe {
            width: 40px; 
            height: 40px; 
            border-radius: 5px;
            position: absolute; 
            top: -100px; 
            left: 50%;
            transform: translate(-50%, 0); /* –ù–∞—á–∞–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
            display: none; 
            text-align: center;
            line-height: 40px;
            font-size: 20px; 
            z-index: 10;
            transition: box-shadow 0.1s;
        }

        /* 5 –¢–ò–ü–û–í –ö–ò–†–û–ö */
        .pickaxe-wood { background-color: #a0522d; }
        .pickaxe-stone { background-color: #999; }
        .pickaxe-iron { background-color: #C0C0C0; }
        .pickaxe-diamond { background-color: #00bcd4; box-shadow: 0 0 10px rgba(0, 255, 255, 0.7); }
        .pickaxe-netherite { background-color: #36454F; box-shadow: 0 0 15px rgba(255, 0, 0, 0.9); }
        
        /* --- 4. –≠–ª–µ–º–µ–Ω—Ç—ã –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è --- */
        #controls {
            padding: 10px;
            width: 100%;
            max-width: 600px;
            background-color: #2b2b2b;
            text-align: center;
            position: fixed; 
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
            box-sizing: border-box;
            z-index: 20;
        }

        .pickaxe-button {
            padding: 8px 12px; 
            margin: 5px 2px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: background-color 0.2s, transform 0.1s;
        }
        .pickaxe-button:active {
            transform: scale(0.98);
        }

        .pickaxe-button[data-type="wood"] { background-color: #9c5e3d; }
        .pickaxe-button[data-type="stone"] { background-color: #999; }
        .pickaxe-button[data-type="iron"] { background-color: #6a6a6a; }
        .pickaxe-button[data-type="diamond"] { background-color: #00bcd4; color: #1a1a1a; }
        .pickaxe-button[data-type="netherite"] { background-color: #36454F; color: #FFD700; border: 1px solid #FFD700; }
        
        #message {
            margin-top: 5px;
            min-height: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="pickaxe">‚õèÔ∏è</div> 
        
        <div id="arena">
            </div>
    </div>

    <div id="controls">
        <h3>üí∞ –ë–∞–ª–∞–Ω—Å: <span id="balance">10000</span></h3>
        <p>–ö—É–ø–∏—Ç–µ –∫–∏—Ä–∫—É:</p>
        <button class="pickaxe-button" data-type="wood" data-price="100">–î–µ—Ä–µ–≤–æ (100)</button>
        <button class="pickaxe-button" data-type="stone" data-price="300">–ö–∞–º–µ–Ω—å (300)</button>
        <button class="pickaxe-button" data-type="iron" data-price="800">–ñ–µ–ª–µ–∑–æ (800)</button>
        <button class="pickaxe-button" data-type="diamond" data-price="2500">–ê–ª–º–∞–∑ (2500)</button>
        <button class="pickaxe-button" data-type="netherite" data-price="5000">–ù–µ–∑–µ—Ä–∏—Ç (5000)</button>
        <p id="message">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∏—Ä–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!</p>
    </div>
    
    <script>
        // --- 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ---
        const Telegram = window.Telegram ? window.Telegram.WebApp : null;
        if (Telegram) Telegram.ready();
        
        const ARENA_WIDTH_BLOCKS = 6;
        const BLOCK_SIZE_PX = 50; 
        const PICKAXE_SIZE_PX = 40; 
        const WALL_WIDTH_PX = 30; 
        const GAME_WIDTH_PX = (ARENA_WIDTH_BLOCKS * BLOCK_SIZE_PX) + (2 * WALL_WIDTH_PX);

        const arena = document.getElementById('arena');
        const pickaxeElement = document.getElementById('pickaxe');
        const gameContainer = document.getElementById('game-container');
        const balanceElement = document.getElementById('balance');
        const messageElement = document.getElementById('message');
        
        const GRAVITY = 0.98; // –£–≤–µ–ª–∏—á–µ–Ω–∞ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –¥–ª—è –±–æ–ª–µ–µ "—Ç—è–∂–µ–ª–æ–≥–æ" –ø–∞–¥–µ–Ω–∏—è
        const INITIAL_SPEED_MAX = 12; // –£–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
        const WALL_BOUNCE = 0.8; // –£–º–µ–Ω—å—à–µ–Ω –æ—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
        const BLOCK_BOUNCE = 0.3; // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç—Å–∫–æ–∫ –æ—Ç –±–ª–æ–∫–∞
        
        const CAMERA_SMOOTHNESS = 0.04; 
        const CAMERA_OFFSET_Y = 0.35; 
        const ROWS_TO_GENERATE_AT_ONCE = 20; // –°–∫–æ–ª—å–∫–æ —Ä—è–¥–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞ —Ä–∞–∑
        const LOAD_TRIGGER_DISTANCE = 500; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–æ–Ω—Ü–∞ –∞—Ä–µ–Ω—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤

        let playerBalance = 10000; // –ù–û–í–´–ô –ë–ê–õ–ê–ù–°
        let activePickaxe = null; 
        let lastTime = 0;
        let totalRows = 0; // –°—á–µ—Ç—á–∏–∫ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤

        // --- 2. –ö–ª–∞—Å—Å –ö–∏—Ä–∫–∏ (–§–∏–∑–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Å –≤—Ä–∞—â–µ–Ω–∏–µ–º) ---
        class Pickaxe {
            constructor(type) {
                this.type = type;
                this.element = pickaxeElement;
                this.width = PICKAXE_SIZE_PX;
                this.height = PICKAXE_SIZE_PX;
                
                // –ü–æ–∑–∏—Ü–∏—è
                const arenaInnerWidth = GAME_WIDTH_PX - 2 * WALL_WIDTH_PX - this.width;
                this.x = WALL_WIDTH_PX + (Math.random() * arenaInnerWidth);
                this.y = gameContainer.scrollTop - PICKAXE_SIZE_PX; 
                
                // –°–∫–æ—Ä–æ—Å—Ç—å
                this.vx = (Math.random() * INITIAL_SPEED_MAX * 2) - INITIAL_SPEED_MAX; 
                this.vy = -(Math.random() * INITIAL_SPEED_MAX / 2); 
                
                // –í—Ä–∞—â–µ–Ω–∏–µ (–ù–û–í–ê–Ø –§–ò–ó–ò–ö–ê)
                this.rotation = 0; // –¢–µ–∫—É—â–∏–π —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è
                this.vRotation = (Math.random() * 0.4) - 0.2; // –£–≥–ª–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                
                this.element.className = `pickaxe-placeholder pickaxe-${type}`;
                this.element.style.display = 'block';
                this.updateDOM();
            }

            updateDOM() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –≤—Ä–∞—â–µ–Ω–∏–µ
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
                this.element.style.transform = `translate(-50%, 0) rotate(${this.rotation}deg)`;
            }

            update(deltaTime) {
                // –§–∏–∑–∏–∫–∞
                this.vy += GRAVITY * deltaTime; 
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;
                
                // –í—Ä–∞—â–µ–Ω–∏–µ
                this.rotation += this.vRotation * deltaTime * 5; 
                this.vRotation *= 0.999; // –ù–µ–±–æ–ª—å—à–æ–µ —Ç—Ä–µ–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏—è
                
                // 2. –ö–æ–ª–ª–∏–∑–∏—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏
                const minX = WALL_WIDTH_PX;
                const maxX = GAME_WIDTH_PX - WALL_WIDTH_PX - this.width;

                if (this.x < minX) {
                    this.x = minX;
                    this.vx *= -WALL_BOUNCE; 
                    this.vRotation = (Math.random() * 0.4) - 0.2; // –í—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞—Ä–µ
                } else if (this.x > maxX) {
                    this.x = maxX;
                    this.vx *= -WALL_BOUNCE; 
                    this.vRotation = (Math.random() * 0.4) - 0.2; 
                }
                
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ç—Ä–µ–Ω–∏–µ
                this.vx *= 0.995; 
                
                // 3. –ö–æ–ª–ª–∏–∑–∏—è —Å –±–ª–æ–∫–∞–º–∏
                if (this.y + this.height > gameContainer.scrollTop) { 
                    const blockHit = this.checkCollisionWithBlocks();
                    if (blockHit) {
                        this.handleHit(blockHit);
                    }
                }
                
                this.updateDOM();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–ª–µ—Ç–∞
                if (this.y > gameContainer.scrollTop + gameContainer.clientHeight + 300) {
                    return false;
                }
                
                return true; 
            }
            
            checkCollisionWithBlocks() {
                const relativeX = this.x - WALL_WIDTH_PX + (this.width / 2);
                const colIndex = Math.floor(relativeX / BLOCK_SIZE_PX);
                const rowIndex = Math.floor((this.y + this.height) / BLOCK_SIZE_PX); 

                const blockElement = arena.querySelector(`[data-row="${rowIndex}"][data-col="${colIndex}"]`);

                if (blockElement && !blockElement.classList.contains('mined')) {
                    const blockRect = blockElement.getBoundingClientRect();
                    const containerRect = gameContainer.getBoundingClientRect();
                    
                    const blockY = blockRect.top - containerRect.top + gameContainer.scrollTop; 
                    
                    if (this.y + this.height > blockY) {
                         return blockElement;
                    }
                }
                return null;
            }

            handleHit(blockElement) {
                // --- –°–ò–ú–£–õ–Ø–¶–ò–Ø –õ–û–ì–ò–ö–ò –ë–≠–ö–ï–ù–î–ê ---
                const isBlockMined = Math.random() < 0.2; 

                if (isBlockMined) {
                    blockElement.classList.add('mined');
                    messageElement.textContent = `üéâ –ü–û–ë–ï–î–ê! –ë–ª–æ–∫ ${blockElement.textContent} —Å–ª–æ–º–∞–Ω!`;
                } else {
                    messageElement.textContent = `üí• –ö–∏—Ä–∫–∞ ${this.type} —É–¥–∞—Ä–∏–ª–∞ ${blockElement.textContent}. –°–ª–∏—à–∫–æ–º –ø—Ä–æ—á–Ω–æ!`;
                }

                // –û—Ç—Å–∫–æ–∫ –æ—Ç –±–ª–æ–∫–∞
                this.vy = -this.vy * BLOCK_BOUNCE; 
                this.vx *= 0.9; 
                this.vRotation = (Math.random() * 0.8) - 0.4; // –°–∏–ª—å–Ω—ã–π –∏–º–ø—É–ª—å—Å –≤—Ä–∞—â–µ–Ω–∏—è
            }
        }
        
        // --- 3. –ò–≥—Ä–æ–≤–æ–π –¶–∏–∫–ª, –ö–∞–º–µ—Ä–∞ –∏ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ---

        function smoothCameraFollow() {
            if (!activePickaxe) return;

            const targetY = activePickaxe.y;
            const containerHeight = gameContainer.clientHeight;
            
            const targetScrollTop = targetY - (containerHeight * CAMERA_OFFSET_Y);
            
            const currentScrollTop = gameContainer.scrollTop;
            const delta = targetScrollTop - currentScrollTop;
            
            const newScrollTop = currentScrollTop + (delta * CAMERA_SMOOTHNESS);
            
            gameContainer.scrollTop = newScrollTop;
        }

        function checkAndGenerateNewRows() {
            const arenaHeight = totalRows * BLOCK_SIZE_PX;
            const scrollBottom = gameContainer.scrollTop + gameContainer.clientHeight;
            
            // –ï—Å–ª–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –±–ª–∏–∑–∫–∞ –∫ –∫–æ–Ω—Ü—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∞—Ä–µ–Ω—ã
            if (scrollBottom + LOAD_TRIGGER_DISTANCE > arenaHeight) {
                generateNewRows(ROWS_TO_GENERATE_AT_ONCE);
                messageElement.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${ROWS_TO_GENERATE_AT_ONCE} –Ω–æ–≤—ã—Ö —Ä—è–¥–æ–≤. –ì–ª—É–±–∏–Ω–∞: ${totalRows}`;
            }
        }
        
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastTime) / 16.67; 
            lastTime = currentTime;
            
            if (activePickaxe) {
                const isActive = activePickaxe.update(Math.min(deltaTime, 3)); 
                smoothCameraFollow(); 
                
                if (!isActive) {
                     activePickaxe = null;
                     pickaxeElement.style.display = 'none';
                     messageElement.textContent = "–ö–∏—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞ —Å–≤–æ–π –ø–æ–ª—ë—Ç. –ö—É–ø–∏—Ç–µ –Ω–æ–≤—É—é.";
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏ –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∏—Ä–∫–∏, —á—Ç–æ–±—ã —à–∞—Ö—Ç–∞ –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª–∞—Å—å
            checkAndGenerateNewRows(); 
            
            requestAnimationFrame(gameLoop);
        }

        // --- 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ê—Ä–µ–Ω—ã ---
        
        const INITIAL_ROWS = 15; 
        const BLOCK_TYPES = ['dirt', 'stone', 'coal', 'iron', 'gold', 'diamond', 'emerald'];
        
        function getBlockTypeByDepth(row) {
             if (row < 10) return Math.random() < 0.8 ? 'dirt' : 'stone';
             if (row < 30) return Math.random() < 0.7 ? 'stone' : 'coal';
             if (row < 60) {
                 const rand = Math.random();
                 if (rand < 0.7) return 'stone';
                 if (rand < 0.9) return 'iron';
                 return 'gold';
             }
             // –ì–ª—É–±–æ–∫–æ (–±–æ–ª—å—à–µ 60): –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ—Ä–æ–≥–∏—Ö —Ä—É–¥
             const rand = Math.random();
             if (rand < 0.5) return 'stone';
             if (rand < 0.7) return 'iron';
             if (rand < 0.85) return 'gold';
             if (rand < 0.95) return 'diamond';
             return 'emerald';
        }

        function generateRows(startRow, count) {
            for (let r = startRow; r < startRow + count; r++) {
                // –õ–µ–≤–∞—è —Å—Ç–µ–Ω–∞
                const wallLeft = document.createElement('div');
                wallLeft.className = 'wall left';
                arena.appendChild(wallLeft);
                
                for (let c = 0; c < ARENA_WIDTH_BLOCKS; c++) {
                    const block = document.createElement('div');
                    
                    const blockType = getBlockTypeByDepth(r);
                    
                    block.className = `block block-${blockType}`;
                    block.textContent = blockType.toUpperCase();
                    block.dataset.row = r;
                    block.dataset.col = c;
                    
                    arena.appendChild(block);
                }
                
                // –ü—Ä–∞–≤–∞—è —Å—Ç–µ–Ω–∞
                const wallRight = document.createElement('div');
                wallRight.className = 'wall right';
                arena.appendChild(wallRight);
            }
            totalRows += count;
        }
        
        function generateInitialArena(rows) {
            generateRows(0, rows);
        }

        function generateNewRows(count) {
            generateRows(totalRows, count);
        }
        
        // --- 5. –õ–æ–≥–∏–∫–∞ –ö–Ω–æ–ø–æ–∫ –∏ –ó–∞–ø—É—Å–∫ ---
        
        document.querySelectorAll('.pickaxe-button').forEach(button => {
            button.addEventListener('click', () => {
                if (activePickaxe) {
                    messageElement.textContent = 'üõë –î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ –∫–∏—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç –±—Ä–æ—Å–æ–∫!';
                    return;
                }
                
                const price = parseInt(button.dataset.price);
                const type = button.dataset.type;
                
                if (playerBalance >= price) {
                    playerBalance -= price;
                    balanceElement.textContent = playerBalance;
                    
                    activePickaxe = new Pickaxe(type);
                    messageElement.textContent = `üöÄ ${type.toUpperCase()} –∫–∏—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞!`;
                } else {
                    messageElement.textContent = `üö´ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ (${price - playerBalance} –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç).`;
                }
            });
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
        balanceElement.textContent = playerBalance;
        
        // –ó–∞–ø—É—Å–∫
        generateInitialArena(INITIAL_ROWS); 
        requestAnimationFrame(gameLoop); 
    </script>
</body>
</html>
