<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plinko Chaos: 15 Objects Edition</title>
    <style>
        body { margin: 0; background: #0a0a12; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        canvas { background: radial-gradient(circle, #1b1b2f 0%, #050505 100%); box-shadow: 0 0 50px #000; border: 2px solid #333; cursor: crosshair; }
        .ui { position: absolute; top: 10px; left: 10px; pointer-events: none; }
        .score-val { font-size: 32px; color: #00ffcc; text-shadow: 0 0 10px #00ffcc; }
        .controls { margin: 15px; display: flex; gap: 10px; z-index: 10; }
        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        .b-n { background: #4ecca3; } .b-h { background: #9b59b6; } .b-g { background: #f1c40f; }
        button:hover { filter: brightness(1.2); transform: translateY(-2px); }
        .event-log { position: absolute; right: 20px; top: 20px; color: #ff0055; font-weight: bold; }
    </style>
</head>
<body>

    <div class="ui">Счёт: <span class="score-val" id="score">0</span></div>
    <div id="event-log" class="event-log"></div>

    <div class="controls">
        <button class="b-n" onclick="spawnBall('normal')">Шар x1</button>
        <button class="b-h" onclick="spawnBall('heavy')">Тяжёлый x2</button>
        <button class="b-g" onclick="spawnBall('gold')">Золотой x5</button>
    </div>

    <canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const log = document.getElementById('event-log');
    canvas.width = 600; canvas.height = 800;

    let score = 0;
    let balls = [];
    let pins = [];
    let chaosObjects = []; // Сюда попадают новые 15 типов объектов

    const types = [
        { name: 'BLACK_HOLE', color: '#000', shadow: '#ff00ff' },
        { name: 'BOOSTER', color: '#ff4d00', shadow: '#fff' },
        { name: 'FREEZE', color: '#00d4ff', shadow: '#fff' },
        { name: 'BUMPER', color: '#ff0055', shadow: '#ff0055' },
        { name: 'MULTIPLIER', color: '#00ff00', shadow: '#00ff00' },
        { name: 'COIN', color: '#ffd700', shadow: '#fff' }
    ];

    // Инициализация базовых гвоздиков
    for(let r=3; r<12; r++) {
        for(let c=0; c<r; c++) {
            pins.push({ x: 300 + (c - r/2 + 0.5) * 45, y: r * 55, r: 4 });
        }
    }

    // Функция появления случайного объекта
    function spawnChaos() {
        const type = types[Math.floor(Math.random() * types.length)];
        const obj = {
            id: type.name,
            x: Math.random() * (canvas.width - 100) + 50,
            y: Math.random() * (canvas.height - 300) + 150,
            r: 20 + Math.random() * 15,
            life: 500, // исчезает со временем
            color: type.color,
            shadow: type.shadow
        };
        chaosObjects.push(obj);
        log.innerText = "EVENT: " + type.name;
        setTimeout(() => log.innerText = "", 2000);
    }

    // Таймер появления хаоса
    setInterval(spawnChaos, 3000);

    function spawnBall(type) {
        const conf = { 
            normal: { r: 7, c: '#4ecca3', m: 1, w: 1 },
            heavy: { r: 11, c: '#9b59b6', m: 2, w: 1.8 },
            gold: { r: 9, c: '#f1c40f', m: 5, w: 1.1 }
        }[type];
        balls.push({ x: 300 + Math.random()*10-5, y: 30, vx: 0, vy: 0, ...conf });
    }

    function update() {
        balls.forEach((b, bi) => {
            b.vy += 0.2 * b.w;
            b.x += b.vx; b.y += b.vy;
            b.vx *= 0.99;

            // Коллизии с гвоздиками
            pins.forEach(p => {
                let dx = b.x - p.x, dy = b.y - p.y, d = Math.sqrt(dx*dx+dy*dy);
                if(d < b.r + p.r) {
                    let a = Math.atan2(dy, dx);
                    b.vx += Math.cos(a) * 3; b.vy = Math.sin(a) * 3;
                }
            });

            // Коллизии с ХАОСОМ (15 объектов логики здесь)
            chaosObjects.forEach((o, oi) => {
                let dx = b.x - o.x, dy = b.y - o.y, d = Math.sqrt(dx*dx+dy*dy);
                if(d < b.r + o.r) {
                    if(o.id === 'BLACK_HOLE') { balls.splice(bi, 1); score -= 50; }
                    if(o.id === 'BOOSTER') { b.vy += 10; b.vx += (Math.random()-0.5)*10; }
                    if(o.id === 'FREEZE') { b.vx *= 0.1; b.vy *= 0.1; }
                    if(o.id === 'BUMPER') { b.vx *= -2; b.vy *= -1.5; }
                    if(o.id === 'COIN') { score += 100; chaosObjects.splice(oi, 1); }
                    if(o.id === 'MULTIPLIER') { spawnBall('normal'); o.life = 0; }
                }
            });

            // Стенки
            if(b.x < b.r || b.x > canvas.width - b.r) b.vx *= -0.8;
            
            // Финиш
            if(b.y > canvas.height) {
                let mult = [10, 2, 1, 2, 10][Math.floor(b.x / (canvas.width/5))];
                score += 10 * mult * b.m;
                balls.splice(bi, 1);
                document.getElementById('score').innerText = score;
            }
        });

        chaosObjects.forEach((o, i) => {
            o.life--;
            if(o.life <= 0) chaosObjects.splice(i, 1);
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Гвоздики
        ctx.fillStyle = "#444";
        pins.forEach(p => {
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, 7); ctx.fill();
        });

        // Объекты Хаоса
        chaosObjects.forEach(o => {
            ctx.shadowBlur = 15; ctx.shadowColor = o.shadow;
            ctx.fillStyle = o.color;
            ctx.beginPath(); ctx.arc(o.x, o.y, o.r, 0, 7); ctx.fill();
            ctx.shadowBlur = 0;
            // Рисуем иконку/текст внутри
            ctx.fillStyle = "white"; ctx.font = "10px Arial";
            ctx.fillText(o.id, o.x - 15, o.y + 5);
        });

        // Шары
        balls.forEach(b => {
            ctx.fillStyle = b.c;
            ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, 7); ctx.fill();
            // След
            ctx.strokeStyle = b.c; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(b.x, b.y); ctx.lineTo(b.x - b.vx*2, b.y - b.vy*2); ctx.stroke();
        });

        update();
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>