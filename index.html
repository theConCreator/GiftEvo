<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç–∞ –ü–æ–¥–∞—Ä–∫–æ–≤</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* =======================================
           1. –ë–∞–∑–æ–≤—ã–µ –°—Ç–∏–ª–∏ –∏ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
           ======================================= */
        body {
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ TWA –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ —Ç–µ–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
            background-color: var(--tg-theme-bg-color, #1a1a2e); 
            color: var(--tg-theme-text-color, #ffffff);
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s;
        }

        .header {
            width: 90%;
            max-width: 400px;
            padding: 15px 0;
            text-align: center;
        }

        .balance, .current-prize {
            font-size: 1.1em;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--tg-theme-hint-color, #aaaaaa);
        }
        
        .balance span, .current-prize span {
             color: var(--tg-theme-link-color, #007bff);
        }

        .game-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* =======================================
           2. –°—Ç–∏–ª–∏ –°–∫—Ä–µ—Ç—á-–ö–∞—Ä—Ç—ã
           ======================================= */
        #scratchCardContainer {
            width: 300px;
            height: 300px;
        }

        .card-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-secondary-bg-color, #2b2b48);
            border-radius: 15px;
            border: 2px dashed var(--tg-theme-button-color, #4a4a75);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.5;
        }

        .scratch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 10px;
            background-color: var(--tg-theme-secondary-bg-color, #3c3c63);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        
        .scratch-cell {
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* –¶–≤–µ—Ç "—Å—Ç–∏—Ä–∞–µ–º–æ–≥–æ" —Å–ª–æ—è */
            background-color: var(--tg-theme-button-color, #8c52ff); 
            border-radius: 8px;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
            user-select: none;
            position: relative;
        }
        
        .scratch-cell:active {
            transform: scale(0.98);
        }
        
        .scratched {
            /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–æ—Å–ª–µ —Å—Ç–∏—Ä–∞–Ω–∏—è */
            background-color: var(--tg-theme-secondary-bg-color, #2b2b48); 
        }

        .hidden-prize {
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* =======================================
           3. –°—Ç–∏–ª–∏ –ö–Ω–æ–ø–∫–∏
           ======================================= */
        .footer {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 0;
        }

        .buy-button {
            background-color: var(--tg-theme-button-color, #007bff); 
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            width: 90%;
            max-width: 350px;
        }

        .buy-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .win-message {
            text-align: center;
            font-size: 1.5em;
            color: #00ff00; /* –Ø—Ä–∫–∏–π —Ü–≤–µ—Ç –¥–ª—è –ø–æ–±–µ–¥—ã */
            margin-bottom: 15px;
            animation: pulse 1s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="balance">
            –ë–∞–ª–∞–Ω—Å: <span id="tonBalance">10.50 TON</span>
        </div>
        <div class="current-prize">
            –ü–æ—Å–ª–µ–¥–Ω–∏–π –í—ã–∏–≥—Ä—ã—à: <span id="currentPrize">0 TON</span>
        </div>
    </header>

    <main class="game-container">
        <div id="scratchCardContainer">
            <div class="card-placeholder">
                –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É!
            </div>
        </div>
    </main>

    <footer class="footer">
        <button id="buyCardButton" class="buy-button">
            üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (1 TON)
        </button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('scratchCardContainer');
            const buyButton = document.getElementById('buyCardButton');
            const currentPrizeDisplay = document.getElementById('currentPrize');
            const tonBalanceDisplay = document.getElementById('tonBalance');

            // --- TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                // –î–µ–ª–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–Ω–æ–ø–∫—É TWA –Ω–µ–≤–∏–¥–∏–º–æ–π, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–≤–æ—é
                Telegram.WebApp.MainButton.hide(); 
                console.log("Telegram Web App –≥–æ—Ç–æ–≤.");
            }
            // --- –ö–æ–Ω–µ—Ü TWA –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ---


            // –ù–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∏—Ö –º–Ω–æ–∂–∏—Ç–µ–ª–∏ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –ª–æ–≥–∏–∫–∏)
            const PRIZES = [
                { symbol: 'üòÇ', multiplier: 0.5 }, // –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª–æ–≤–∏–Ω—ã
                { symbol: '‚≠ê', multiplier: 2.0 }, // x2
                { symbol: 'üíé', multiplier: 5.0 }, // x5
                { symbol: 'ü™ô', multiplier: 10.0 } // x10
            ];
            const CARD_COST = 1.0;
            const CARD_SIZE = 9; 
            let scratchCount = 0;
            let currentPrizes = [];
            let testBalance = 10.50; // –¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å
            
            // –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            function updateBalance(amount) {
                testBalance += amount;
                tonBalanceDisplay.textContent = testBalance.toFixed(2) + ' TON';
            }

            /**
             * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã (–¢–µ—Å—Ç–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
             * –í —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å –ë–≠–ö–ï–ù–î–ê —Å —á–µ—Å—Ç–Ω—ã–º –ì–°–ß
             */
            function generateRandomPrizes() {
                const prizes = [];
                for (let i = 0; i < CARD_SIZE; i++) {
                    const randomIndex = Math.floor(Math.random() * PRIZES.length);
                    prizes.push(PRIZES[randomIndex].symbol);
                }
                
                // –í–ê–ñ–ù–û: –¥–ª—è *–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏* –≤—ã–∏–≥—Ä—ã—à–∞, –∏–Ω–æ–≥–¥–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏–º —Ç—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                if (Math.random() < 0.3) { // –®–∞–Ω—Å 30% –Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à (–¥–ª—è —Ç–µ—Å—Ç–∞)
                    const winningSymbol = PRIZES[Math.floor(Math.random() * 3) + 1].symbol; // –ë–µ—Ä–µ–º –Ω–µ x0.5
                    prizes[0] = winningSymbol;
                    prizes[1] = winningSymbol;
                    prizes[2] = winningSymbol;
                }

                return prizes;
            }

            /**
             * –°–æ–∑–¥–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –Ω–æ–≤—É—é —Å–∫—Ä–µ—Ç—á-–∫–∞—Ä—Ç—É
             */
            function generateNewCard() {
                cardContainer.innerHTML = '';
                scratchCount = 0;
                currentPrizes = generateRandomPrizes();
                
                const cardGrid = document.createElement('div');
                cardGrid.classList.add('scratch-grid');
                
                currentPrizes.forEach((prize, index) => {
                    const cell = document.createElement('div');
                    cell.classList.add('scratch-cell');
                    cell.dataset.index = index;
                    
                    cell.innerHTML = `<span class="hidden-prize">${prize}</span>`;
                    cell.addEventListener('click', handleScratch);
                    cardGrid.appendChild(cell);
                });

                cardContainer.appendChild(cardGrid);
            }
            
            /**
             * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∏—Ä–∞–Ω–∏—è —è—á–µ–π–∫–∏
             */
            function handleScratch(event) {
                const cell = event.currentTarget;
                
                if (cell.classList.contains('scratched')) return;

                cell.classList.add('scratched');
                cell.querySelector('.hidden-prize').style.opacity = '1';
                cell.removeEventListener('click', handleScratch);
                
                scratchCount++;
                
                if (scratchCount === CARD_SIZE) {
                    checkResult();
                    setTimeout(showNextCardPrompt, 2500); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                }
            }

            /**
             * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
             */
            function checkResult() {
                const prizeCounts = {};
                currentPrizes.forEach(prize => {
                    prizeCounts[prize] = (prizeCounts[prize] || 0) + 1;
                });

                let winningMultiplier = 0;

                for (const symbol of Object.keys(prizeCounts)) {
                    if (prizeCounts[symbol] >= 3) {
                        const winPrize = PRIZES.find(p => p.symbol === symbol);
                        if (winPrize) {
                            winningMultiplier = winPrize.multiplier;
                            break; // –ù–∞—à–ª–∏ –≤—ã–∏–≥—Ä—ã—à, –≤—ã—Ö–æ–¥–∏–º
                        }
                    }
                }
                
                const winAmount = winningMultiplier * CARD_COST;
                
                if (winAmount > 0) {
                    const message = `üéâ –í—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(2)} TON! (x${winningMultiplier})`;
                    cardContainer.insertAdjacentHTML('beforebegin', `<div class="win-message">${message}</div>`);
                    updateBalance(winAmount);
                    currentPrizeDisplay.textContent = winAmount.toFixed(2) + ' TON';
                } else {
                    const message = `üòî –ù–µ –ø–æ–≤–µ–∑–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`;
                    cardContainer.insertAdjacentHTML('beforebegin', `<div class="win-message" style="color:#ff3333;">${message}</div>`);
                    currentPrizeDisplay.textContent = '0 TON';
                }

                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–∏–≥—Ä—ã—à–µ —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    const msg = document.querySelector('.win-message');
                    if (msg) msg.remove();
                }, 2500);
            }

            /**
             * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
             */
            function showNextCardPrompt() {
                cardContainer.innerHTML = `
                    <div class="card-placeholder">
                        –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ö–∞—Ä—Ç—É", —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞!
                    </div>
                `;
                buyButton.disabled = false;
                buyButton.textContent = `üí∞ –ö—É–ø–∏—Ç—å –ù–æ–≤—É—é –ö–∞—Ä—Ç—É (${CARD_COST} TON)`;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å"
            buyButton.addEventListener('click', () => {
                if (testBalance < CARD_COST) {
                    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –Ω–∞ –±–∞–ª–∞–Ω—Å–µ!");
                    return;
                }
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ –ø–ª–∞—Ç–µ–∂–∞ TON –∏ –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã —Å –ë–≠–ö–ï–ù–î–ê.
                updateBalance(-CARD_COST); // –°–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
                
                buyButton.disabled = true;
                buyButton.textContent = '–°—Ç–∏—Ä–∞–π—Ç–µ —è—á–µ–π–∫–∏...';
                
                generateNewCard();
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            updateBalance(0); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å
            showNextCardPrompt(); 
        });
    </script>
</body>
</html>