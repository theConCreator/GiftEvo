<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Bet Launcher</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #050505;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas {
            display: block;
            background-color: #000;
        }

        #ui {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 20, 25, 0.9);
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid #444;
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 320px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            color: #f1c40f;
            font-size: 18px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .controls-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        label { font-size: 14px; color: #ccc; }

        input[type=range] { width: 140px; cursor: pointer; }
        input[type=number] { 
            width: 80px; 
            background: #222; 
            border: 1px solid #555; 
            color: white; 
            padding: 4px; 
            border-radius: 4px;
        }

        button {
            padding: 12px;
            background: #e67e22;
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s, transform 0.1s;
        }

        button:hover { background: #d35400; }
        button:active { transform: scale(0.98); }
        button:disabled { background: #34495e; cursor: not-allowed; }

        #overlay {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none;
            width: 100%;
        }

        .status-msg { font-size: 28px; font-weight: bold; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .win { color: #2ecc71; }
        .lose { color: #e74c3c; }
    </style>
</head>
<body>

    <div id="overlay">
        <div id="status" class="status-msg">Приготовьтесь к запуску</div>
    </div>

    <div id="ui">
        <div class="info-row">
            <span>Баланс:</span>
            <span id="balanceDisplay">1000</span>
        </div>
        
        <div class="controls-group">
            <label>Ваша ставка:</label>
            <input type="number" id="betInput" value="10" min="1">
        </div>

        <div class="controls-group">
            <label>Угол:</label>
            <input type="range" id="angleInput" min="0" max="360" value="270">
            <span id="angleVal" style="width: 40px">270°</span>
        </div>

        <div class="controls-group">
            <label>Сила:</label>
            <input type="range" id="powerInput" min="10" max="100" value="60">
            <span id="powerVal" style="width: 40px">60</span>
        </div>

        <button id="launchBtn">ЗАПУСТИТЬ РАКЕТУ</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/**
 * НАСТРОЙКИ (Карта уменьшена в 2.5 раза: 2000 / 2.5 = 800)
 */
const MAP_RADIUS = 800; 
const MAX_FLIGHT_TIME = 8000;
const GRAVITY_CONSTANT = 0.6;
const GRAVITY_FIELD_FACTOR = 1.25;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let width, height;
let gameState = 'PREPARE'; // PREPARE, FLYING, END
let planets = [];
let balance = 1000;
let currentBet = 0;

let rocket = {
    x: 0, y: 0, vx: 0, vy: 0,
    history: []
};

let camera = {
    zoom: 4,
    x: 0, y: 0,
    targetZoom: 4
};

let flightStartTime = 0;

function init() {
    resize();
    createPlanets();
    resetRocket();
    window.addEventListener('resize', resize);
    animate();
}

function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
}

/**
 * СОЗДАНИЕ ПЛАНЕТ С ИКСАМИ 0.8 - 10.0
 */
function createPlanets() {
    planets = [];
    const count = 4 + Math.floor(Math.random() * 3);
    
    // Диапазон радиусов для планет (влияет на сложность)
    const minR = 20;
    const maxR = 60;

    for (let i = 0; i < count; i++) {
        const radius = minR + Math.random() * (maxR - minR);
        
        // Маппинг радиуса в множитель: 
        // Самая маленькая (20) -> 10.0x
        // Самая большая (60) -> 0.8x
        const t = (radius - minR) / (maxR - minR);
        const multiplier = (10.0 - t * (10.0 - 0.8)).toFixed(2);
        
        planets.push({
            radius: radius,
            orbitRadius: 180 + (i * 100), // Расстояние уменьшено под новую карту
            orbitAngle: Math.random() * Math.PI * 2,
            orbitSpeed: (0.004 / (radius / 40)),
            color: `hsl(${Math.random() * 360}, 65%, 55%)`,
            multiplier: parseFloat(multiplier),
            x: 0, y: 0
        });
    }
}

function resetRocket() {
    rocket.x = 0;
    rocket.y = 0;
    rocket.vx = 0;
    rocket.vy = 0;
    rocket.history = [];
    gameState = 'PREPARE';
    camera.targetZoom = 4;
    camera.x = 0;
    camera.y = 0;
    
    document.getElementById('ui').style.pointerEvents = "auto";
    document.getElementById('ui').style.opacity = "1";
    document.getElementById('launchBtn').disabled = false;
    
    const statusEl = document.getElementById('status');
    statusEl.innerText = "Сделайте ставку и запуск";
    statusEl.className = "status-msg";
}

function update() {
    // Движение планет
    planets.forEach(p => {
        p.orbitAngle += p.orbitSpeed;
        p.x = Math.cos(p.orbitAngle) * p.orbitRadius;
        p.y = Math.sin(p.orbitAngle) * p.orbitRadius;
    });

    if (gameState === 'FLYING') {
        const elapsed = Date.now() - flightStartTime;

        planets.forEach(p => {
            const dx = p.x - rocket.x;
            const dy = p.y - rocket.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < p.radius * GRAVITY_FIELD_FACTOR) {
                const force = (p.radius * GRAVITY_CONSTANT) / (dist * dist);
                rocket.vx += (dx / dist) * force * 12;
                rocket.vy += (dy / dist) * force * 12;
            }

            if (dist < p.radius) win(p);
        });

        rocket.x += rocket.vx;
        rocket.y += rocket.vy;
        rocket.history.push({x: rocket.x, y: rocket.y});
        if (rocket.history.length > 40) rocket.history.shift();

        const distFromCenter = Math.sqrt(rocket.x**2 + rocket.y**2);
        if (distFromCenter > MAP_RADIUS) {
            lose("Вылет за пределы системы!");
        } else if (elapsed > MAX_FLIGHT_TIME) {
            lose("Время полета истекло!");
        }

        // Камера следит за ракетой
        camera.x = rocket.x;
        camera.y = rocket.y;
    }

    // Плавный зум
    camera.zoom += (camera.targetZoom - camera.zoom) * 0.08;
}

function win(planet) {
    gameState = 'END';
    const winAmount = Math.floor(currentBet * planet.multiplier);
    balance += winAmount;
    
    const statusEl = document.getElementById('status');
    statusEl.innerText = `ПОБЕДА! x${planet.multiplier} (+${winAmount})`;
    statusEl.classList.add('win');
    
    updateUI();
    setTimeout(resetRocket, 3000);
}

function lose(msg) {
    gameState = 'END';
    const statusEl = document.getElementById('status');
    statusEl.innerText = msg;
    statusEl.classList.add('lose');
    
    updateUI();
    setTimeout(resetRocket, 3000);
}

function updateUI() {
    document.getElementById('balanceDisplay').innerText = Math.floor(balance);
}

function draw() {
    ctx.clearRect(0, 0, width, height);
    ctx.save();
    
    ctx.translate(width / 2, height / 2);
    ctx.scale(camera.zoom, camera.zoom);
    ctx.translate(-camera.x, -camera.y);

    // Граница (атмосфера системы)
    ctx.beginPath();
    ctx.arc(0, 0, MAP_RADIUS, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
    ctx.lineWidth = 2 / camera.zoom;
    ctx.stroke();

    // Планеты
    planets.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
        
        // Подписи множителей
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.scale(1/camera.zoom, 1/camera.zoom);
        ctx.fillStyle = "white";
        ctx.font = "bold 14px Arial";
        ctx.textAlign = "center";
        ctx.fillText(`${p.multiplier}x`, 0, -p.radius * camera.zoom - 10);
        ctx.restore();
    });

    // Ракета и шлейф
    if (rocket.history.length > 1) {
        ctx.beginPath();
        ctx.moveTo(rocket.history[0].x, rocket.history[0].y);
        rocket.history.forEach(pt => ctx.lineTo(pt.x, pt.y));
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
        ctx.lineWidth = 1 / camera.zoom;
        ctx.stroke();
    }

    ctx.save();
    ctx.translate(rocket.x, rocket.y);
    if (gameState === 'FLYING') {
        ctx.rotate(Math.atan2(rocket.vy, rocket.vx) + Math.PI/2);
    } else {
        ctx.rotate((document.getElementById('angleInput').value * Math.PI / 180) + Math.PI/2);
    }
    ctx.beginPath();
    ctx.moveTo(0, -8);
    ctx.lineTo(5, 8);
    ctx.lineTo(-5, 8);
    ctx.closePath();
    ctx.fillStyle = '#fff';
    ctx.fill();
    ctx.restore();

    ctx.restore();
}

function animate() {
    update();
    draw();
    requestAnimationFrame(animate);
}

/**
 * ЛОГИКА ЗАПУСКА
 */
document.getElementById('launchBtn').addEventListener('click', () => {
    const betVal = parseInt(document.getElementById('betInput').value);
    
    if (isNaN(betVal) || betVal <= 0) {
        alert("Введите корректную ставку");
        return;
    }
    if (betVal > balance) {
        alert("Недостаточно средств!");
        return;
    }

    // Списание ставки
    currentBet = betVal;
    balance -= currentBet;
    updateUI();

    const angle = document.getElementById('angleInput').value * Math.PI / 180;
    const power = document.getElementById('powerInput').value / 12;

    rocket.vx = Math.cos(angle) * power;
    rocket.vy = Math.sin(angle) * power;
    
    gameState = 'FLYING';
    flightStartTime = Date.now();
    
    // Мгновенная настройка камеры на "Zoom Out", чтобы видеть всю карту
    // Вычисляем оптимальный зум, чтобы MAP_RADIUS вписался в экран
    const minSide = Math.min(width, height);
    camera.targetZoom = minSide / (MAP_RADIUS * 2.3); 

    document.getElementById('ui').style.opacity = "0.2";
    document.getElementById('ui').style.pointerEvents = "none";
    document.getElementById('launchBtn').disabled = true;
    document.getElementById('status').innerText = "Полет...";
});

// Слушатели для UI
document.getElementById('angleInput').addEventListener('input', (e) => {
    document.getElementById('angleVal').innerText = e.target.value + '°';
});
document.getElementById('powerInput').addEventListener('input', (e) => {
    document.getElementById('powerVal').innerText = e.target.value;
});

init();
</script>
</body>
</html>